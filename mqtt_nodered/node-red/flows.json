[
    {
        "id": "8cc0dadb75774b52",
        "type": "tab",
        "label": "MQTT in, vehicle state, actuators",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "053268593fae8c42",
        "type": "tab",
        "label": "Map",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "bd7de6c3e385f05f",
        "type": "tab",
        "label": "Easter",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "072468ee5a218dc0",
        "type": "tab",
        "label": "V2 Robot State",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1301e8ab7fdd3e72",
        "type": "mqtt-broker",
        "name": "mqtt_broker",
        "broker": "broker",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "95aa286d35eafbda",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "71f95dd3ceeb2145",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Command and Conquer Subs",
            "hideToolbar": "true",
            "allowSwipe": "false",
            "lockMenu": "icon",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 40,
                "sy": 40,
                "gx": 2,
                "gy": 2,
                "cx": 2,
                "cy": 2,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "1417de57d250f31f",
        "type": "ui_group",
        "name": "State",
        "tab": "95aa286d35eafbda",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cd81d08b.eebb3",
        "type": "ui_group",
        "z": "8cc0dadb75774b52",
        "name": "Default",
        "tab": "b34078e6.e60df8",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "b34078e6.e60df8",
        "type": "ui_tab",
        "z": "8cc0dadb75774b52",
        "name": "Home",
        "icon": "dashboard"
    },
    {
        "id": "102ceb2b72c23b34",
        "type": "ui_group",
        "name": "Map",
        "tab": "95aa286d35eafbda",
        "order": 2,
        "disp": false,
        "width": 18,
        "collapse": false,
        "className": ""
    },
    {
        "id": "d95a7e5bd038651c",
        "type": "key-value-store",
        "filepath": "waypoints.json",
        "namespace": "",
        "name": "waypoints"
    },
    {
        "id": "52f0dbb4c9ed8309",
        "type": "ui_group",
        "name": "Security",
        "tab": "95aa286d35eafbda",
        "order": 5,
        "disp": true,
        "width": "3",
        "collapse": true,
        "className": ""
    },
    {
        "id": "53ba06c1420a4513",
        "type": "ui_tab",
        "name": "Globals",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "f5a1a6343a549333",
        "type": "ui_group",
        "name": "Globals",
        "tab": "53ba06c1420a4513",
        "order": 1,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "9dbddaa8775473fd",
        "type": "ui_group",
        "name": "Waypoint",
        "tab": "95aa286d35eafbda",
        "order": 3,
        "disp": true,
        "width": "4",
        "collapse": true,
        "className": ""
    },
    {
        "id": "574bd822e17b1c3f",
        "type": "ui_group",
        "name": "Mission Plan",
        "tab": "95aa286d35eafbda",
        "order": 4,
        "disp": true,
        "width": "7",
        "collapse": true,
        "className": ""
    },
    {
        "id": "99b5f7c7e1f62814",
        "type": "key-value-store",
        "filepath": "mission_plans.json",
        "namespace": "",
        "name": "mission plans"
    },
    {
        "id": "9e2bac96.b321b",
        "type": "ui_group",
        "name": "S1",
        "tab": "62712bbf.888b94",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false
    },
    {
        "id": "62712bbf.888b94",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard"
    },
    {
        "id": "014f9035e48813bb",
        "type": "ui_tab",
        "name": "V2",
        "icon": "gear",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a48b13904097fb6a",
        "type": "ui_group",
        "name": "Robot Info",
        "tab": "014f9035e48813bb",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "9f2da61.3353758",
        "type": "ui_group",
        "name": "Flight",
        "tab": "d6d3c358.5fb46",
        "order": 1,
        "disp": true,
        "width": "20",
        "collapse": false
    },
    {
        "id": "d6d3c358.5fb46",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "81d4dedb195938c4",
        "type": "ui_group",
        "name": "BT State",
        "tab": "014f9035e48813bb",
        "order": 2,
        "disp": true,
        "width": "10",
        "collapse": true,
        "className": ""
    },
    {
        "id": "6d93d1d6e9d2a07b",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "lat_lon",
        "topic": "smarc/+/dr/lat_lon",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 260,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "1a856d4522e1e254",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "Yaw",
        "topic": "smarc/+/dr/yaw",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 300,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "9b2d0437d1859a32",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "Depth",
        "topic": "smarc/+/dr/depth",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 420,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "1a815b3ddbbf0285",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "Roll",
        "topic": "smarc/+/dr/roll",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 340,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "e515c359bd2b65d3",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "Pitch",
        "topic": "smarc/+/dr/pitch",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 380,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "cec96d72fa5a1f3d",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "VBS_fb",
        "topic": "smarc/+/core/vbs_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 460,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "49b4a86719760597",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "LCG_fb",
        "topic": "smarc/+/core/lcg_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 500,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "b9def8576fb40145",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "T1_fb",
        "topic": "smarc/+/core/thruster1_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 540,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "1f47fb9bdf2432dc",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "T2_fb",
        "topic": "smarc/+/core/thruster2_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 580,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "600e8a4fd93b8b33",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "batt",
        "topic": "smarc/+/core/battery",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 620,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "19f8f48675c600ed",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "gps",
        "topic": "smarc/+/core/gps",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 660,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "84e9d8bb8aca3954",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "Altitude",
        "topic": "smarc/+/dr/altitude",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 700,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "28d38018bfd6084b",
        "type": "inject",
        "z": "8cc0dadb75774b52",
        "name": "0.2s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "active_vehicle",
        "payloadType": "global",
        "x": 210,
        "y": 1120,
        "wires": [
            [
                "8429b678ad11f94e",
                "4c8dc3f2305dd06a"
            ]
        ]
    },
    {
        "id": "75e2505923e210c8",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "goto_wp_goal",
        "topic": "smarc/+/bt/last_wp",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 740,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "48bd42de4f79dcdf",
        "type": "comment",
        "z": "8cc0dadb75774b52",
        "name": "goal obj",
        "info": "goal: object\n    waypoint: object\n        pose: object\n        goal_tolerance: 5\n        z_control_mode: 1\n        travel_altitude: 0\n        travel_depth: 0\n        speed_control_mode: 1\n        travel_rpm: 1000\n        travel_speed: 0\n        lat: 1.0166838140439685\n        lon: 0.199858858981976",
        "x": 310,
        "y": 740,
        "wires": []
    },
    {
        "id": "89a02e38feb8e62a",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G waypoints",
        "properties": [
            {
                "p": "waypoints",
                "pt": "global",
                "to": "{}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 710,
        "y": 240,
        "wires": []
    },
    {
        "id": "45e404335095cc6b",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "bt tip",
        "topic": "smarc/+/bt/tip",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 780,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "e4e7d91b635d63b1",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "bt tip",
        "func": "tip = msg.payload.tip;\nc = \"black\"\nswitch(tip.status){\n    case \"failure\":\n        c = \"red\"\n        break\n    case \"success\":\n        c = \"green\"\n        break\n    case \"running\":\n        c = \"blue\"\n        break\n}\n\ns = tip.name + \":\" + tip.message;\nvar m = {payload:s, strongcolor:c, color:c};\nreturn m;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 1420,
        "wires": [
            [
                "64b3a0e8d8c4dd5e"
            ]
        ]
    },
    {
        "id": "947467be6e9b43e1",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "livewp enable",
        "topic": "smarc/+/bt/live_wp/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 820,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "2b0af13e81a43f9b",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "algae enable",
        "topic": "smarc/+/bt/algae_farm/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 860,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "8a73a400bdc80f26",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G security",
        "properties": [
            {
                "p": "map_pw",
                "pt": "global",
                "to": "1",
                "tot": "str"
            },
            {
                "p": "map_pw_timeleft_secs",
                "pt": "global",
                "to": "0",
                "tot": "num"
            },
            {
                "p": "disable_count",
                "pt": "global",
                "to": "0",
                "tot": "num"
            }
        ],
        "active": true,
        "x": 720,
        "y": 280,
        "wires": []
    },
    {
        "id": "58bfd1be028c15be",
        "type": "ui_led",
        "z": "8cc0dadb75774b52",
        "order": 5,
        "group": "9dbddaa8775473fd",
        "width": 4,
        "height": 1,
        "label": "ALGAE",
        "labelPlacement": "left",
        "labelAlignment": "right",
        "colorForValue": [
            {
                "color": "#ff0000",
                "value": "false",
                "valueType": "bool"
            },
            {
                "color": "#008000",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "allowColorForValueInMessage": false,
        "shape": "circle",
        "showGlow": true,
        "name": "algae",
        "x": 870,
        "y": 1460,
        "wires": []
    },
    {
        "id": "44a2505c433e9aef",
        "type": "change",
        "z": "8cc0dadb75774b52",
        "name": "algae farm enable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.algae_farm_enable",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1460,
        "wires": [
            [
                "58bfd1be028c15be"
            ]
        ]
    },
    {
        "id": "f1f9f9ebc0364948",
        "type": "ui_led",
        "z": "8cc0dadb75774b52",
        "order": 4,
        "group": "9dbddaa8775473fd",
        "width": 4,
        "height": 1,
        "label": "LIVE-WP",
        "labelPlacement": "left",
        "labelAlignment": "right",
        "colorForValue": [
            {
                "color": "#ff0000",
                "value": "false",
                "valueType": "bool"
            },
            {
                "color": "#008000",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "allowColorForValueInMessage": false,
        "shape": "circle",
        "showGlow": true,
        "name": "live",
        "x": 870,
        "y": 1500,
        "wires": []
    },
    {
        "id": "6a031635d274a714",
        "type": "change",
        "z": "8cc0dadb75774b52",
        "name": "livewp enable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.live_wp_enable",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 1500,
        "wires": [
            [
                "f1f9f9ebc0364948"
            ]
        ]
    },
    {
        "id": "4027428873576c95",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G Vehicles",
        "properties": [
            {
                "p": "vehicles",
                "pt": "global",
                "to": "{}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 710,
        "y": 160,
        "wires": []
    },
    {
        "id": "a28e3fd079e64616",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "Register Vehicle",
        "func": "vehicles = global.get(\"vehicles\");\n\nparts = msg.topic.split('/')\nconst [smarc, msg_robot_name, ...topic_parts] = parts;\nmsg_mqtt_topic = topic_parts.join(\"/\")\n\nnew_vehicle = false\n\n// if first time seeing this robot\n    // only register if there is a heartbeat\nif(!(msg_robot_name in vehicles) && msg_mqtt_topic == \"bt/heartbeat\"){\n    // gotta make a clone. and this seems the easiest....\n    v = JSON.parse(JSON.stringify(global.get(\"vehicle_state_template\")));\n    v.basic_state.name = msg_robot_name;\n    v.basic_state.label = msg_robot_name;\n    v.basic_state.layer = msg_robot_name;\n    v.gps_fix.layer = msg_robot_name;\n    vehicles[msg_robot_name] = v\n    global.set(\"vehicles\", vehicles);\n    node.warn(\"Registered new vehicle \"+v.basic_state.name);\n    new_vehicle = true\n}\n\nmsg.name = msg_robot_name\nmsg.topic = msg_mqtt_topic\nmsg.new_vehicle = new_vehicle\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 580,
        "wires": [
            [
                "352a27f086708676",
                "fd9509825ed48013"
            ]
        ]
    },
    {
        "id": "fac0c95e2d7a78f8",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G Vehicle State Template",
        "properties": [
            {
                "p": "vehicle_state_template",
                "pt": "global",
                "to": "{\"basic_state\":{\"name\":\"\",\"label\":\"\",\"lat\":null,\"lon\":null,\"heading\":0,\"roll\":0,\"pitch\":0,\"depth\":0,\"altitude\":0,\"vbs\":0,\"lcg\":0,\"tcg\":0,\"t1\":0,\"t2\":0,\"batt_v\":0,\"icon\":\"ship\",\"color\":\"yellow\",\"iconColor\":\"yellow\",\"layer\":\"Vehicle\"},\"gps_fix\":{\"name\":\"gps_fix\",\"label\":\"\",\"lat\":null,\"lon\":null,\"icon\":\"satellite\",\"color\":\"green\",\"iconColor\":\"green\",\"layer\":\"Vehicle\"},\"bt_state\":{\"tip\":{\"name\":\"???\",\"message\":\"\",\"status\":\"???\"},\"algae_farm_enable\":false,\"live_wp_enable\":false,\"gui_wp_enable\":false,\"current_wp\":{},\"current_plan\":{},\"last_heartbeat\":null}}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 670,
        "y": 120,
        "wires": []
    },
    {
        "id": "352a27f086708676",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "update vehicle state",
        "func": "function to_deg(d){\n    deg = d * (180/Math.PI);\n    deg = deg%360;\n    return deg;\n}\n\nfunction to_northing(d){\n    h = Math.PI/2 - d;\n    return to_deg(h);\n}\n\nvs = global.get(\"vehicles\");\nif(!(msg.name in vs)){\n    //node.warn(\"Vehicle \"+msg.name+\" is not in the list?\")\n    return\n}\nv = vs[msg.name];\n\n\n/* Vehicle template:\n{\n    \"basic_state\":{\n        \"name\": \"\",\n        \"label\": \"\",\n        \"lat\": null,\n        \"lon\": null,\n        \"heading\": 0,\n        \"roll\": 0,\n        \"pitch\": 0,\n        \"depth\": 0,\n        \"altitude\": 0,\n        \"vbs\": 0,\n        \"lcg\": 0,\n        \"tcg\": 0,\n        \"t1\": 0,\n        \"t2\": 0,\n        \"batt_v\": 0,\n        \"icon\": \"ship\",\n        \"color\": \"yellow\",\n        \"iconColor\": \"yellow\",\n        \"layer\": \"Vehicle\"\n    },\n    \"gps_fix\": {\n        \"name\": \"gps_fix\",\n        \"label\": \"\",\n        \"lat\": null,\n        \"lon\": null,\n        \"icon\": \"satellite\",\n        \"color\": \"green\",\n        \"iconColor\": \"green\",\n        \"layer\": \"Vehicle\"\n    },\n    \"bt_state\": {\n        \"tip\": {\n            \"name\": \"???\",\n            \"message\": \"\"\n        },\n        \"algae_farm_enable\": false,\n        \"localization_enable\": false,\n        \"current_wp\": {},\n        \"current_plan\": {}\n    }\n}\n*/\nvar payload = msg.payload;\nswitch(msg.topic){\n    case \"dr/lat_lon\":\n        v.basic_state.lat = payload.latitude;\n        v.basic_state.lon = payload.longitude;\n        break;\n        \n    case \"dr/yaw\":\n        v.basic_state.heading = to_northing(payload.data);\n        break;\n        \n    case \"dr/roll\":\n        v.basic_state.roll = to_deg(payload.data);\n        break;\n        \n    case \"dr/pitch\":\n        v.basic_state.pitch = to_deg(payload.data);\n        break;\n        \n    case \"dr/depth\":\n        v.basic_state.depth = payload.data;\n        break;\n\n    case \"dr/altitude\":\n        v.basic_state.altitude = payload.data;\n        break;        \n        \n    case \"core/vbs_fb\":\n        v.basic_state.vbs = payload.value;\n        break;\n        \n    case \"core/lcg_fb\":\n        v.basic_state.lcg = payload.value;\n        break;\n        \n    case \"core/thruster1_fb\":\n        v.basic_state.t1 = payload.rpm.rpm;\n        break;\n        \n    case \"core/thruster2_fb\":\n        v.basic_state.t2 = payload.rpm.rpm;\n        break;\n        \n    case \"core/battery\":\n        v.basic_state.batt_v = payload.voltage;\n        break;\n        \n    case \"core/gps\":\n        v.gps_fix.lat = payload.latitude;\n        v.gps_fix.lon = payload.longitude;\n        v.gps_fix.name = v.basic_state.name + \"_gps_fix\"\n        break;\n        \n    case \"bt/last_wp\":\n        if(payload.pose.header.frame_id == \"utm\"){\n            v.bt_state.current_wp = payload;\n        }\n        break;\n        \n    case \"bt/tip\":\n        v.bt_state.tip.name = payload.name;\n        v.bt_state.tip.message = payload.message;\n        switch(payload.status){\n            case 0:\n                v.bt_state.tip.status = \"unknown\"\n                break\n            case 1:\n                v.bt_state.tip.status = \"invalid\"\n                break\n            case 2:\n                v.bt_state.tip.status = \"running\"\n                break\n            case 3:\n                v.bt_state.tip.status = \"success\"\n                break\n            case 4:\n                v.bt_state.tip.status = \"failure\"\n                break\n        }\n        break;\n        \n    case \"bt/live_wp/enable\":\n        v.bt_state.live_wp_enable = payload.data;\n        break;\n        \n    case \"bt/algae_farm/enable\":\n        v.bt_state.algae_farm_enable = payload.data;\n        break;\n        \n    case \"bt/gui_wp/enable\":\n        v.bt_state.gui_wp_enable = payload.data;\n        break;\n        \n    case \"bt/heartbeat\":\n        v.bt_state.last_heartbeat = Date.now()\n        break;\n        \n    case \"bt/mission_control\":\n        if(payload.command == 5){ // is_feedback\n            v.bt_state.current_plan = payload\n        }\n}\n\nvs[msg.name] = v;\n//node.warn(v.basic_state.name + \" <- \" + msg.topic + \"-\" + msg.name)\nglobal.set(\"vehicles\", vs);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "47b308426c2c1c2c",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G active_vehicle",
        "properties": [
            {
                "p": "active_vehicle",
                "pt": "global",
                "to": "",
                "tot": "str"
            }
        ],
        "active": true,
        "x": 700,
        "y": 200,
        "wires": []
    },
    {
        "id": "8429b678ad11f94e",
        "type": "ui_text",
        "z": "8cc0dadb75774b52",
        "group": "1417de57d250f31f",
        "order": 2,
        "width": 5,
        "height": 1,
        "name": "active veh",
        "label": "Active vehicle:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 380,
        "y": 1080,
        "wires": []
    },
    {
        "id": "4c8dc3f2305dd06a",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "active_vehicle_basic_state",
        "func": "name = global.get(\"active_vehicle\");\nvs = global.get(\"vehicles\");\nif(name in vs){\n    v = vs[name];\n    return {payload:v.basic_state};\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1120,
        "wires": [
            [
                "d8cdca46ac124119",
                "79d9ddbe6b73b50f"
            ]
        ]
    },
    {
        "id": "d8cdca46ac124119",
        "type": "split",
        "z": "8cc0dadb75774b52",
        "name": "split_keys",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "key",
        "x": 660,
        "y": 940,
        "wires": [
            [
                "bf04ca75f8f0d841"
            ]
        ]
    },
    {
        "id": "bf04ca75f8f0d841",
        "type": "switch",
        "z": "8cc0dadb75774b52",
        "name": "",
        "property": "key",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "heading",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "roll",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pitch",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "vbs",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "lcg",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "tcg",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "t1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "t2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "batt_v",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "depth",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "altitude",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 11,
        "x": 790,
        "y": 940,
        "wires": [
            [
                "68e37a7a4d467a49"
            ],
            [
                "9608a3f69f063504"
            ],
            [
                "be4fcbcdc106841b"
            ],
            [
                "9b160c7dc6cf0f42"
            ],
            [
                "b4896f88274e79eb"
            ],
            [
                "b89f97ecfd6f8bb4"
            ],
            [
                "1b309e82c6d130b9"
            ],
            [
                "eb781abcadeb5b67"
            ],
            [
                "41213d1a752c77dd"
            ],
            [
                "f5a1927d0bd28c49"
            ],
            [
                "079ff2a8e8b0864f"
            ]
        ]
    },
    {
        "id": "68e37a7a4d467a49",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "Heading",
        "group": "1417de57d250f31f",
        "order": 5,
        "width": 2,
        "height": 2,
        "gtype": "compass",
        "title": "Northing",
        "label": "deg",
        "format": "{{value | number:1}}",
        "min": "-359",
        "max": "359",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1200,
        "y": 720,
        "wires": []
    },
    {
        "id": "be4fcbcdc106841b",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "Pitch",
        "group": "1417de57d250f31f",
        "order": 6,
        "width": 2,
        "height": 2,
        "gtype": "compass",
        "title": "Pitch",
        "label": "deg",
        "format": "{{value | number:1}}",
        "min": "-90",
        "max": "90",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1190,
        "y": 800,
        "wires": []
    },
    {
        "id": "9608a3f69f063504",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "Roll",
        "group": "1417de57d250f31f",
        "order": 7,
        "width": 2,
        "height": 2,
        "gtype": "compass",
        "title": "Roll",
        "label": "deg",
        "format": "{{value | number:1}}",
        "min": "-180",
        "max": "180",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1190,
        "y": 760,
        "wires": []
    },
    {
        "id": "9b160c7dc6cf0f42",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "VBS",
        "group": "1417de57d250f31f",
        "order": 8,
        "width": 4,
        "height": 4,
        "gtype": "wave",
        "title": "VBS",
        "label": "%",
        "format": "{{value | number:2}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 1190,
        "y": 840,
        "wires": []
    },
    {
        "id": "b4896f88274e79eb",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "LCG",
        "group": "1417de57d250f31f",
        "order": 9,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "LCG",
        "label": "%",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 1190,
        "y": 880,
        "wires": []
    },
    {
        "id": "1b309e82c6d130b9",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "T1",
        "group": "1417de57d250f31f",
        "order": 11,
        "width": 3,
        "height": 3,
        "gtype": "gage",
        "title": "T1",
        "label": "rpm",
        "format": "{{value | number:1}}",
        "min": "-2000",
        "max": "2000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "-800",
        "seg2": "800",
        "className": "",
        "x": 1190,
        "y": 960,
        "wires": []
    },
    {
        "id": "eb781abcadeb5b67",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "T2",
        "group": "1417de57d250f31f",
        "order": 12,
        "width": 3,
        "height": 3,
        "gtype": "gage",
        "title": "T2",
        "label": "rpm",
        "format": "{{value | number:1}}",
        "min": "-2000",
        "max": "2000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "-800",
        "seg2": "800",
        "className": "",
        "x": 1190,
        "y": 1000,
        "wires": []
    },
    {
        "id": "b89f97ecfd6f8bb4",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "TCG",
        "group": "1417de57d250f31f",
        "order": 10,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "TCG",
        "label": "%",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 1190,
        "y": 920,
        "wires": []
    },
    {
        "id": "033ad9746b755359",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "",
        "group": "1417de57d250f31f",
        "order": 13,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Battery V",
        "label": "V",
        "format": "{{value | number:2}}",
        "min": "10",
        "max": "14",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "12",
        "seg2": "13",
        "className": "",
        "x": 1240,
        "y": 1040,
        "wires": []
    },
    {
        "id": "f5a1927d0bd28c49",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "prep depth 4 plot",
        "func": "msg.payload = -msg.payload;\nmsg.topic = \"depth\";\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1120,
        "wires": [
            [
                "7e93394aa67a22c5"
            ]
        ]
    },
    {
        "id": "079ff2a8e8b0864f",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "prep alt 4 plot",
        "func": "msg.payload = -msg.payload;\nmsg.topic = \"alti\";\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 1160,
        "wires": [
            [
                "38ca092118fa2e3c"
            ]
        ]
    },
    {
        "id": "79d9ddbe6b73b50f",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "bottom",
        "func": "alt = msg.payload.altitude;\ndep = msg.payload.depth;\nbot = dep+alt;\nvar m = {\"payload\": -bot,\n\"topic\":\"bottom\"};\nreturn m;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1200,
        "wires": [
            [
                "579d1ecfcf970deb"
            ]
        ]
    },
    {
        "id": "1e97bca67b525bf1",
        "type": "ui_chart",
        "z": "8cc0dadb75774b52",
        "name": "alt depth",
        "group": "102ceb2b72c23b34",
        "order": 7,
        "width": 18,
        "height": 5,
        "label": "",
        "chartType": "line",
        "legend": "true",
        "xformat": "auto",
        "interpolate": "linear",
        "nodata": "NONE",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "5",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#804040",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1360,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "7e93394aa67a22c5",
        "type": "delay",
        "z": "8cc0dadb75774b52",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1190,
        "y": 1120,
        "wires": [
            [
                "1e97bca67b525bf1"
            ]
        ]
    },
    {
        "id": "38ca092118fa2e3c",
        "type": "delay",
        "z": "8cc0dadb75774b52",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1190,
        "y": 1160,
        "wires": [
            [
                "1e97bca67b525bf1"
            ]
        ]
    },
    {
        "id": "579d1ecfcf970deb",
        "type": "delay",
        "z": "8cc0dadb75774b52",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1190,
        "y": 1200,
        "wires": [
            [
                "1e97bca67b525bf1"
            ]
        ]
    },
    {
        "id": "11888389b48776f8",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "active_vehicle_bt_state",
        "func": "name = global.get(\"active_vehicle\");\nvs = global.get(\"vehicles\");\nif(name in vs){\n    v = vs[name];\n    return {payload:v.bt_state};\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1460,
        "wires": [
            [
                "e4e7d91b635d63b1",
                "44a2505c433e9aef",
                "6a031635d274a714",
                "97107647fbc41899",
                "24410997d80f5149",
                "3419610e604c77b1"
            ]
        ]
    },
    {
        "id": "ac77511e45a57bd7",
        "type": "inject",
        "z": "8cc0dadb75774b52",
        "name": "0.3s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.3",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 1460,
        "wires": [
            [
                "11888389b48776f8"
            ]
        ]
    },
    {
        "id": "97107647fbc41899",
        "type": "ui_text",
        "z": "8cc0dadb75774b52",
        "group": "f5a1a6343a549333",
        "order": 1,
        "width": "5",
        "height": "18",
        "name": "",
        "label": "BT state",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 640,
        "y": 1580,
        "wires": []
    },
    {
        "id": "64091fc4b58e9d7e",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G Mission Plans",
        "properties": [
            {
                "p": "mission_plans",
                "pt": "global",
                "to": "{}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 700,
        "y": 320,
        "wires": []
    },
    {
        "id": "0e26fcd18aabedb7",
        "type": "config",
        "z": "8cc0dadb75774b52",
        "name": "G GUI state",
        "properties": [
            {
                "p": "gui_state",
                "pt": "global",
                "to": "{\"selected_wp\":{},\"selected_plan\":{},\"planning_mode\":false,\"batt_v_minmax\":[-1,-1],\"draw_tracks\":false}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 710,
        "y": 360,
        "wires": []
    },
    {
        "id": "0b7292754967ad41",
        "type": "ui_switch",
        "z": "8cc0dadb75774b52",
        "name": "",
        "label": "GUI-WP",
        "tooltip": "Sends the AUV to the selected WP",
        "group": "9dbddaa8775473fd",
        "order": 6,
        "width": 4,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 620,
        "y": 1780,
        "wires": [
            [
                "a3520c2ebe8995c4"
            ]
        ]
    },
    {
        "id": "50c6de4ee1cfcdee",
        "type": "mqtt out",
        "z": "8cc0dadb75774b52",
        "name": "guiwp_enable",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1301e8ab7fdd3e72",
        "x": 720,
        "y": 1860,
        "wires": []
    },
    {
        "id": "a3520c2ebe8995c4",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "payload{data}",
        "func": "name = global.get(\"active_vehicle\");\nm = {\"payload\": {\"data\":msg.payload},\n    \"topic\": \"smarc/\"+name+\"/bt_cmd/gui_wp/enable\"\n};\nreturn m",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 1820,
        "wires": [
            [
                "50c6de4ee1cfcdee"
            ]
        ]
    },
    {
        "id": "4b6203d899c22cfb",
        "type": "inject",
        "z": "8cc0dadb75774b52",
        "name": "0.3s",
        "props": [],
        "repeat": "0.3",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 190,
        "y": 1740,
        "wires": [
            [
                "f83ff3091c4615eb"
            ]
        ]
    },
    {
        "id": "f83ff3091c4615eb",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "selected wp",
        "func": "gs = global.get(\"gui_state\")\nwp = gs.selected_wp\nif(wp){\n    return {payload:wp}\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 1780,
        "wires": [
            [
                "f494794aeb435526"
            ]
        ]
    },
    {
        "id": "d2cd5f598f37da47",
        "type": "mqtt out",
        "z": "8cc0dadb75774b52",
        "name": "guiwp_wp",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1301e8ab7fdd3e72",
        "x": 400,
        "y": 1980,
        "wires": []
    },
    {
        "id": "f494794aeb435526",
        "type": "switch",
        "z": "8cc0dadb75774b52",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 280,
        "y": 1820,
        "wires": [
            [
                "b2ebe8f261e2ee04"
            ]
        ]
    },
    {
        "id": "b02a0a564855195c",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "loc/wp topic",
        "func": "name = global.get(\"active_vehicle\");\nm = {\"payload\": msg.payload,\n    \"topic\": \"smarc/\"+name+\"/bt_cmd/gui_wp/wp\"\n};\nreturn m;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1940,
        "wires": [
            [
                "d2cd5f598f37da47"
            ]
        ]
    },
    {
        "id": "b2ebe8f261e2ee04",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "make_wp",
        "func": "wp = {\n  \"pose\": {\n    \"header\": {\n      \"seq\": 0,\n      \"stamp\": {\n        \"secs\": 0,\n        \"nsecs\": 0\n      },\n      \"frame_id\": \"latlon\"\n    },\n    \"pose\": {\n      \"position\": {\n        \"x\": 0,\n        \"y\": 0,\n        \"z\": 0\n      },\n      \"orientation\": {\n        \"x\": 0,\n        \"y\": 0,\n        \"z\": 0,\n        \"w\": 0\n      }\n    }\n  },\n  \"goal_tolerance\": 5,\n  \"z_control_mode\": 1, //depth\n  \"travel_altitude\": msg.payload.travel_altitude,\n  \"travel_depth\": msg.payload.travel_depth,\n  \"speed_control_mode\": msg.payload.speed_control_mode, //m/s\n  \"travel_rpm\": msg.payload.travel_rpm,\n  \"travel_speed\": msg.payload.travel_speed,\n  \"lat\": msg.payload.lat,\n  \"lon\": msg.payload.lon,\n  \"name\":msg.payload.name\n}\n\nm = {\"payload\":wp}\nreturn m;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 1860,
        "wires": [
            [
                "470d4856d9b9ec12"
            ]
        ]
    },
    {
        "id": "470d4856d9b9ec12",
        "type": "switch",
        "z": "8cc0dadb75774b52",
        "name": "sam or lolo?",
        "property": "active_vehicle",
        "propertyType": "global",
        "rules": [
            {
                "t": "cont",
                "v": "sam",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "lolo",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 1900,
        "wires": [
            [
                "b02a0a564855195c"
            ],
            [
                "b02a0a564855195c"
            ]
        ]
    },
    {
        "id": "263274d293ee9948",
        "type": "link in",
        "z": "8cc0dadb75774b52",
        "name": "",
        "links": [
            "7f714df460627f98",
            "69e7c18a81f1b55b"
        ],
        "x": 465,
        "y": 1740,
        "wires": [
            [
                "7667a55ed85fce91"
            ]
        ]
    },
    {
        "id": "e623a7f1b5efae8b",
        "type": "ui_button",
        "z": "8cc0dadb75774b52",
        "name": "send",
        "group": "574bd822e17b1c3f",
        "order": 5,
        "width": 7,
        "height": 1,
        "passthru": false,
        "label": "Send to vehicle",
        "tooltip": "",
        "color": "",
        "bgcolor": "green",
        "className": "",
        "icon": "fa-bath",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 310,
        "y": 2160,
        "wires": [
            [
                "fae9c985139be9fa"
            ]
        ]
    },
    {
        "id": "e8e2232722bf1c53",
        "type": "link in",
        "z": "8cc0dadb75774b52",
        "name": "",
        "links": [
            "7f714df460627f98",
            "69e7c18a81f1b55b"
        ],
        "x": 225,
        "y": 2160,
        "wires": [
            [
                "e623a7f1b5efae8b"
            ]
        ]
    },
    {
        "id": "ab0a5b9392c6ff65",
        "type": "mqtt out",
        "z": "8cc0dadb75774b52",
        "name": "mission_control",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1301e8ab7fdd3e72",
        "x": 740,
        "y": 2220,
        "wires": []
    },
    {
        "id": "fae9c985139be9fa",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "make mission control",
        "func": "name = global.get(\"active_vehicle\")\ngs = global.get(\"gui_state\")\nwps = global.get(\"waypoints\")\n\nif(gs.selected_plan){\n    proper_wps = []\n    for(var i in gs.selected_plan.wp_names){\n        wp_name = gs.selected_plan.wp_names[i]\n        wp = wps[wp_name]\n        if(wp){\n            wp_msg = {\n              \"pose\": {\n                \"header\": {\n                  \"seq\": 0,\n                  \"stamp\": {\n                    \"secs\": 0,\n                    \"nsecs\": 0\n                  },\n                  \"frame_id\": \"latlon\"\n                },\n                \"pose\": {\n                  \"position\": {\n                    \"x\": 0,\n                    \"y\": 0,\n                    \"z\": 0\n                  },\n                  \"orientation\": {\n                    \"x\": 0,\n                    \"y\": 0,\n                    \"z\": 0,\n                    \"w\": 0\n                  }\n                }\n              },\n              \"goal_tolerance\": 5,\n              \"z_control_mode\": 1, // depth\n              \"travel_altitude\": wp.travel_altitude,\n              \"travel_depth\": wp.travel_depth,\n              \"speed_control_mode\": wp.speed_control_mode,\n              \"travel_rpm\": wp.travel_rpm,\n              \"travel_speed\": wp.travel_speed,\n              \"lat\": wp.lat,\n              \"lon\": wp.lon,\n              \"name\":wp.name\n            }\n            proper_wps.push(wp_msg)\n        }\n    }\n    mission_control = {\n        name:gs.selected_plan.name,\n        command:4, //set plan\n        waypoints:proper_wps\n    }\n    m = {\n        payload: mission_control,\n        topic: \"smarc/\"+name+\"/bt_cmd/mission_control\"\n    }\n    return m\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 2160,
        "wires": [
            [
                "ab0a5b9392c6ff65",
                "5107794bda2fabf9"
            ]
        ]
    },
    {
        "id": "5107794bda2fabf9",
        "type": "debug",
        "z": "8cc0dadb75774b52",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 2120,
        "wires": []
    },
    {
        "id": "f648bbe0c4e28b41",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "bt heartbeat",
        "topic": "smarc/+/bt/heartbeat",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 900,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "24410997d80f5149",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "secs since last heartbeat",
        "func": "bts = msg.payload\nlast = bts.last_heartbeat\nmillis = Date.now() - last  \nreturn {payload:millis/ 1000}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1380,
        "wires": [
            [
                "034dbf381bd93e09"
            ]
        ]
    },
    {
        "id": "1bdcd57c1547f4c2",
        "type": "ui_gauge",
        "z": "8cc0dadb75774b52",
        "name": "secs",
        "group": "1417de57d250f31f",
        "order": 3,
        "width": 1,
        "height": 1,
        "gtype": "gage",
        "title": "HB",
        "label": "s",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "0.4",
        "colors": [
            "#00ff00",
            "#ffff00",
            "#ff0000"
        ],
        "seg1": "0.3",
        "seg2": "",
        "className": "",
        "x": 1010,
        "y": 1400,
        "wires": []
    },
    {
        "id": "f9040e15e4c6f524",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "bt missioncontrol",
        "topic": "smarc/+/bt/mission_control",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 940,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "621f6f51348de540",
        "type": "link in",
        "z": "8cc0dadb75774b52",
        "name": "",
        "links": [
            "69e7c18a81f1b55b"
        ],
        "x": 215,
        "y": 2260,
        "wires": [
            [
                "cde1b92ecb0af08a",
                "147cbd7546fb94b1",
                "1151739119002b58",
                "554b8efc31d392a7"
            ]
        ]
    },
    {
        "id": "cde1b92ecb0af08a",
        "type": "ui_button",
        "z": "8cc0dadb75774b52",
        "name": "Start",
        "group": "574bd822e17b1c3f",
        "order": 2,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Start",
        "tooltip": "Start the currently selected plan",
        "color": "",
        "bgcolor": "green",
        "className": "",
        "icon": "fa-play",
        "payload": "0",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 310,
        "y": 2220,
        "wires": [
            [
                "f7f8b335cb411f88"
            ]
        ]
    },
    {
        "id": "f7f8b335cb411f88",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "make command",
        "func": "name = global.get(\"active_vehicle\")\ngs = global.get(\"gui_state\")\n\nif(gs.selected_plan){\n    mission_control = {\n        name:gs.selected_plan.name,\n        command:msg.payload //start plan\n    }\n    m = {\n        payload: mission_control,\n        topic: \"smarc/\"+name+\"/bt_cmd/mission_control\"\n    }\n    return m\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 2220,
        "wires": [
            [
                "ab0a5b9392c6ff65"
            ]
        ]
    },
    {
        "id": "147cbd7546fb94b1",
        "type": "ui_button",
        "z": "8cc0dadb75774b52",
        "name": "Pause",
        "group": "574bd822e17b1c3f",
        "order": 3,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Pause",
        "tooltip": "Pause the currently selected plan",
        "color": "",
        "bgcolor": "blue",
        "className": "",
        "icon": "fa-pause",
        "payload": "2",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 310,
        "y": 2300,
        "wires": [
            [
                "f7f8b335cb411f88"
            ]
        ]
    },
    {
        "id": "1151739119002b58",
        "type": "ui_button",
        "z": "8cc0dadb75774b52",
        "name": "Stop",
        "group": "574bd822e17b1c3f",
        "order": 4,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Cancel",
        "tooltip": "Stop the currently selected plan",
        "color": "",
        "bgcolor": "orange",
        "className": "",
        "icon": "fa-stop",
        "payload": "1",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 310,
        "y": 2260,
        "wires": [
            [
                "f7f8b335cb411f88"
            ]
        ]
    },
    {
        "id": "554b8efc31d392a7",
        "type": "ui_button",
        "z": "8cc0dadb75774b52",
        "name": "Abort",
        "group": "1417de57d250f31f",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "ABORT",
        "tooltip": "Emergency stop, one-way street",
        "color": "",
        "bgcolor": "red",
        "className": "",
        "icon": "fa-eject",
        "payload": "3",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 310,
        "y": 2340,
        "wires": [
            [
                "f7f8b335cb411f88"
            ]
        ]
    },
    {
        "id": "fd9509825ed48013",
        "type": "switch",
        "z": "8cc0dadb75774b52",
        "name": "new?",
        "property": "new_vehicle",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 710,
        "y": 620,
        "wires": [
            [
                "4615a84334505823"
            ]
        ]
    },
    {
        "id": "4731ad6ffdda22c4",
        "type": "ui_audio",
        "z": "8cc0dadb75774b52",
        "name": "",
        "group": "1417de57d250f31f",
        "voice": "urn:moz-tts:sapi:Microsoft Zira Desktop - English (United States)?en-US",
        "always": "",
        "x": 1060,
        "y": 640,
        "wires": []
    },
    {
        "id": "26e7ea65f9a11341",
        "type": "ui_toast",
        "z": "8cc0dadb75774b52",
        "position": "top left",
        "displayTime": "2",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1080,
        "y": 600,
        "wires": []
    },
    {
        "id": "034dbf381bd93e09",
        "type": "switch",
        "z": "8cc0dadb75774b52",
        "name": "too late?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 880,
        "y": 1380,
        "wires": [
            [
                "f36fa4401ca841f5"
            ],
            [
                "1bdcd57c1547f4c2"
            ]
        ]
    },
    {
        "id": "cd8ad65ce7f7bef0",
        "type": "ui_audio",
        "z": "8cc0dadb75774b52",
        "name": "",
        "group": "1417de57d250f31f",
        "voice": "urn:moz-tts:sapi:Microsoft Zira Desktop - English (United States)?en-US",
        "always": "",
        "x": 1220,
        "y": 1360,
        "wires": []
    },
    {
        "id": "f00b6b692ab70779",
        "type": "ui_toast",
        "z": "8cc0dadb75774b52",
        "position": "top left",
        "displayTime": "2",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1240,
        "y": 1320,
        "wires": []
    },
    {
        "id": "f36fa4401ca841f5",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "remove active",
        "func": "name = global.get(\"active_vehicle\")\nvs = global.get(\"vehicles\")\nif(name in vs){\n    vs[name].bt_state.last_heartbeat = null\n    global.set(\"active_vehicle\", \"\")\n    msg.payload = \"Vehicle \"+ name + \" timed out\"\n    return msg\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 1360,
        "wires": [
            [
                "cd8ad65ce7f7bef0",
                "f00b6b692ab70779"
            ]
        ]
    },
    {
        "id": "4615a84334505823",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "set active if first",
        "func": "current = global.get(\"active_vehicle\")\nif(current == \"\"){\n    global.set(\"active_vehicle\", msg.name)\n    m = \"First vehicle \"+msg.name+\" set as active\"\n}else{\n    m = \"New vehicle \"+msg.name\n}\nreturn {payload:m}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 620,
        "wires": [
            [
                "26e7ea65f9a11341",
                "4731ad6ffdda22c4",
                "07a1bbac5d3ab58e"
            ]
        ]
    },
    {
        "id": "7667a55ed85fce91",
        "type": "switch",
        "z": "8cc0dadb75774b52",
        "name": "sam or lolo?",
        "property": "active_vehicle",
        "propertyType": "global",
        "rules": [
            {
                "t": "cont",
                "v": "sam",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "lolo",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 1740,
        "wires": [
            [
                "0b7292754967ad41"
            ],
            [
                "0b7292754967ad41"
            ]
        ]
    },
    {
        "id": "c043a32172c4ef31",
        "type": "mqtt in",
        "z": "8cc0dadb75774b52",
        "name": "guiwp enable",
        "topic": "smarc/+/bt/gui_wp/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 980,
        "wires": [
            [
                "a28e3fd079e64616"
            ]
        ]
    },
    {
        "id": "8f8b1d0d7ab4ce9b",
        "type": "ui_led",
        "z": "8cc0dadb75774b52",
        "order": 7,
        "group": "9dbddaa8775473fd",
        "width": 4,
        "height": 1,
        "label": "GUI-WP",
        "labelPlacement": "left",
        "labelAlignment": "right",
        "colorForValue": [
            {
                "color": "#ff0000",
                "value": "false",
                "valueType": "bool"
            },
            {
                "color": "#008000",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "allowColorForValueInMessage": false,
        "shape": "circle",
        "showGlow": true,
        "name": "gui",
        "x": 870,
        "y": 1540,
        "wires": []
    },
    {
        "id": "3419610e604c77b1",
        "type": "change",
        "z": "8cc0dadb75774b52",
        "name": "guiwp enable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.gui_wp_enable",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 1540,
        "wires": [
            [
                "8f8b1d0d7ab4ce9b"
            ]
        ]
    },
    {
        "id": "64b3a0e8d8c4dd5e",
        "type": "ui_text",
        "z": "8cc0dadb75774b52",
        "group": "1417de57d250f31f",
        "order": 14,
        "width": 6,
        "height": 5,
        "name": "Colored text",
        "label": "<font color= {{msg.strongcolor}} > BT Tip </font>",
        "format": "<font color= {{msg.color}} > {{msg.payload}} </font>",
        "layout": "col-center",
        "className": "",
        "x": 850,
        "y": 1420,
        "wires": []
    },
    {
        "id": "41213d1a752c77dd",
        "type": "function",
        "z": "8cc0dadb75774b52",
        "name": "adjust min/max",
        "func": "gui_st = global.get(\"gui_state\")\ng_minmax = gui_st.batt_v_minmax\ng_min = g_minmax[0]\ng_max = g_minmax[1]\n\n//node.warn(g_min+','+g_max+','+msg.payload)\n// 0, 14.5, 12.5\nif(g_min <= 0 || g_min > msg.payload){\n    g_min = msg.payload-2\n    if(g_min < 0){\n        g_min = 0\n    }\n}\nif(g_max == -1 || g_max < msg.payload){\n    g_max = msg.payload+2\n}\n\ngui_st.batt_v_minmax = [g_min, g_max]\n\nmsg.ui_control = {min:g_min ,max:g_max}\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1040,
        "wires": [
            [
                "033ad9746b755359"
            ]
        ]
    },
    {
        "id": "07a1bbac5d3ab58e",
        "type": "link out",
        "z": "8cc0dadb75774b52",
        "name": "",
        "mode": "link",
        "links": [
            "f0807890835d67b1"
        ],
        "x": 975,
        "y": 680,
        "wires": []
    },
    {
        "id": "4f18c0fb5a5708dd",
        "type": "ui_worldmap",
        "z": "053268593fae8c42",
        "group": "102ceb2b72c23b34",
        "order": 6,
        "width": 18,
        "height": 12,
        "name": "",
        "lat": "58.25089840041283",
        "lon": "11.4500587783608",
        "zoom": "18",
        "layer": "EsriS",
        "cluster": "",
        "maxage": "",
        "usermenu": "show",
        "layers": "show",
        "panit": "false",
        "panlock": "false",
        "zoomlock": "false",
        "hiderightclick": "false",
        "coords": "deg",
        "showgrid": "true",
        "allowFileDrop": "false",
        "path": "/worldmap",
        "overlist": "SN",
        "maplist": "EsriS,NatGeo",
        "mapname": "Bathy",
        "mapurl": "https://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv",
        "mapopt": "{ \"maxZoom\":22,\"attribution\":\"&copy; GEBCO\",\"format\":\"image/jpeg\",\"request\":\"getmap\",\"service\":\",\"layers\":\"gebco_latest_2_sub_ice_topo\"}",
        "mapwms": true,
        "x": 1020,
        "y": 240,
        "wires": []
    },
    {
        "id": "1c9e33661e87e2a3",
        "type": "worldmap-tracks",
        "z": "053268593fae8c42",
        "name": "",
        "depth": "10000",
        "layer": "combined",
        "smooth": false,
        "x": 710,
        "y": 80,
        "wires": [
            [
                "528f627a90f6985c"
            ]
        ]
    },
    {
        "id": "24dfa000cb4c2933",
        "type": "comment",
        "z": "053268593fae8c42",
        "name": "special map icons",
        "info": "\n    plane : a jet plane icon that aligns with the heading of travel.\n    smallplane : a light aircraft icon that aligns with the heading of travel.\n    ship : a ship icon that aligns with the heading of travel.\n    car : a car icon that aligns with the heading of travel.\n    bus : a bus/coach icon that aligns with the heading of travel.\n    uav : a small uav like icon that aligns with the heading of travel.\n    helicopter : a small helicopter icon that aligns with the heading of travel.\n    arrow : a map GPS arrow type pointer that aligns with the heading of travel.\n    wind : a wind arrow that points in the direction the wind is coming FROM.\n    satellite : a small satellite icon.\n    iss : a slightly larger icon for the ISS.\n    locate : a 4 corner outline to locate a point without obscuring it.\n    friend : pseudo NATO style blue rectangle. (see NATO SIDC option below)\n    hostile : pseudo NATO style red circle.\n    neutral : pseudo NATO style green square.\n    unknown : pseudo NATO style yellow square.\n    earthquake : black circle - diameter proportional to msg.mag.\n",
        "x": 1190,
        "y": 240,
        "wires": []
    },
    {
        "id": "9cad79d0410d02e9",
        "type": "worldmap in",
        "z": "053268593fae8c42",
        "name": "",
        "path": "/worldmap",
        "events": "connect,disconnect,point,layer,bounds,files,draw,other",
        "x": 120,
        "y": 1020,
        "wires": [
            [
                "8f6b288d88b67fa8"
            ]
        ]
    },
    {
        "id": "8f6b288d88b67fa8",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "point",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "move",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "delete",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "click",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 250,
        "y": 1020,
        "wires": [
            [
                "c9cfb47d68f70e8f"
            ],
            [
                "fc9170fe8371dff0"
            ],
            [
                "007b0ba19f255f0f"
            ],
            [
                "0f02de0042b627c1",
                "3f1101a0eff94520",
                "efb303bf3091ae28"
            ],
            [],
            []
        ]
    },
    {
        "id": "10f6a18739e64d25",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "make_wp",
        "func": "wp = {\n  \"pose\": {\n    \"header\": {\n      \"seq\": 0,\n      \"stamp\": {\n        \"secs\": 0,\n        \"nsecs\": 0\n      },\n      \"frame_id\": \"latlon\"\n    },\n    \"pose\": {\n      \"position\": {\n        \"x\": 0,\n        \"y\": 0,\n        \"z\": 0\n      },\n      \"orientation\": {\n        \"x\": 0,\n        \"y\": 0,\n        \"z\": 0,\n        \"w\": 0\n      }\n    }\n  },\n  \"goal_tolerance\": 5,\n  \"z_control_mode\": 1, //depth\n  \"travel_altitude\": -1,\n  \"travel_depth\": 0,\n  \"speed_control_mode\": 1, //m/s\n  \"travel_rpm\": 200,\n  \"travel_speed\": 1,\n  \"lat\": msg.payload.lat,\n  \"lon\": msg.payload.lon,\n  \"name\":msg.payload.name\n}\n\nwps = global.get(\"waypoints\");\nif(wp.name in wps){\n    wp = wps[wp.name]\n    node.send([null, {payload:\"WP name needs to be unique\"}])\n}\n\nwps[wp.name] = wp;    \nglobal.set(\"waypoints\", wps)\n\nreturn [{payload:wp}, null]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 860,
        "wires": [
            [
                "c2a1d87a52c8ad5f"
            ],
            [
                "22b33628c3c58200"
            ]
        ]
    },
    {
        "id": "3fa36be91868d6c6",
        "type": "key-value-write",
        "z": "053268593fae8c42",
        "store": "d95a7e5bd038651c",
        "action": "set",
        "key": "",
        "keyvalue": "",
        "name": "save_wps",
        "x": 1080,
        "y": 1020,
        "wires": [
            [
                "74385683b57e28cf"
            ]
        ]
    },
    {
        "id": "547e0b3649d6ffca",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy and repeat",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "120",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1150,
        "y": 2360,
        "wires": [
            [
                "7964fafb17064262"
            ]
        ]
    },
    {
        "id": "7964fafb17064262",
        "type": "key-value-read",
        "z": "053268593fae8c42",
        "store": "d95a7e5bd038651c",
        "key": "waypoints",
        "name": "",
        "x": 1450,
        "y": 2360,
        "wires": [
            [
                "50041808f3208548",
                "92e6032ec1defa71"
            ]
        ]
    },
    {
        "id": "76e6c4863dc8bccd",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "save_wps",
        "func": "wps = global.get(\"waypoints\");\nwp_names = Object.keys(wps);\nm = {\n    \"payload\":wps,\n    \"topic\":\"waypoints\",\n    \"options\":wp_names\n};\nreturn m",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 1020,
        "wires": [
            [
                "3fa36be91868d6c6"
            ]
        ]
    },
    {
        "id": "50041808f3208548",
        "type": "split",
        "z": "053268593fae8c42",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1650,
        "y": 2400,
        "wires": [
            [
                "9f71b89c95e41a5d"
            ]
        ]
    },
    {
        "id": "baf8ce41441c9d88",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "links": [
            "0fa2c8c468d4d8e5",
            "8368a65f786f7dcd",
            "8df26b2177e029fc",
            "92f10e36cbc8e2ae",
            "cf60302a5d14ae55",
            "fe6676f1a71e7f3c",
            "e6fb258dd75c7fb6"
        ],
        "x": 935,
        "y": 280,
        "wires": [
            [
                "4f18c0fb5a5708dd"
            ]
        ]
    },
    {
        "id": "211ae464662df16b",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "update_latlon",
        "func": "wps = global.get(\"waypoints\");\newp = wps[msg.payload.name]\nif(ewp){\n    ewp.lat = msg.payload.lat;\n    ewp.lon = msg.payload.lon;\n    wps[msg.payload.name] = ewp;\n}\nreturn {\"payload\":ewp};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 960,
        "wires": [
            [
                "c2a1d87a52c8ad5f",
                "073be28f85ca8d84"
            ]
        ]
    },
    {
        "id": "2843237506ede5ef",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "delete_wp",
        "func": "wps = global.get(\"waypoints\");\ndelete wps[msg.payload.name]\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1040,
        "wires": [
            [
                "c2a1d87a52c8ad5f",
                "073be28f85ca8d84"
            ]
        ]
    },
    {
        "id": "92e6032ec1defa71",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "waypoints",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1700,
        "y": 2360,
        "wires": [
            [
                "e25583298eb669eb"
            ]
        ]
    },
    {
        "id": "9f71b89c95e41a5d",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1770,
        "y": 2400,
        "wires": [
            [
                "137e36108b790425"
            ]
        ]
    },
    {
        "id": "e602c5202df1e782",
        "type": "delay",
        "z": "053268593fae8c42",
        "d": true,
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 2060,
        "wires": [
            [
                "37222f493c892ad1"
            ]
        ]
    },
    {
        "id": "ba746c64ba29a192",
        "type": "ui_toast",
        "z": "053268593fae8c42",
        "d": true,
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 470,
        "y": 2060,
        "wires": [
            [
                "d55c1ec10465de34"
            ]
        ]
    },
    {
        "id": "c9cfb47d68f70e8f",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "pw?",
        "property": "pwok",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 490,
        "y": 900,
        "wires": [
            [
                "10f6a18739e64d25"
            ],
            [
                "c75d8b8be81fe89b"
            ]
        ]
    },
    {
        "id": "fc9170fe8371dff0",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "pw?",
        "property": "pwok",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 1000,
        "wires": [
            [
                "211ae464662df16b"
            ],
            [
                "c75d8b8be81fe89b"
            ]
        ]
    },
    {
        "id": "007b0ba19f255f0f",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "pw?",
        "property": "pwok",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 1080,
        "wires": [
            [
                "2843237506ede5ef"
            ],
            [
                "c75d8b8be81fe89b"
            ]
        ]
    },
    {
        "id": "37222f493c892ad1",
        "type": "change",
        "z": "053268593fae8c42",
        "d": true,
        "name": "\"password?\"",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Enter password to access controls",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 2060,
        "wires": [
            [
                "ba746c64ba29a192"
            ]
        ]
    },
    {
        "id": "65555c354e02cfdc",
        "type": "ui_text_input",
        "z": "053268593fae8c42",
        "name": "pw",
        "label": "password",
        "tooltip": "",
        "group": "102ceb2b72c23b34",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "mode": "password",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 490,
        "y": 2120,
        "wires": [
            [
                "d55c1ec10465de34"
            ]
        ]
    },
    {
        "id": "9d84ea38e5210dd7",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "set pwok true",
        "rules": [
            {
                "t": "set",
                "p": "pwok",
                "pt": "global",
                "to": "true",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Map enabled",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "timeout_mins",
                "pt": "msg",
                "to": "10",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "draggable",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 2060,
        "wires": [
            [
                "f08a47ed118769f3",
                "624f95947dc58e5f"
            ]
        ]
    },
    {
        "id": "b7c3154386a72406",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "pw check",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "map_pw",
                "vt": "global"
            },
            {
                "t": "neq",
                "v": "map_pw",
                "vt": "global"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 740,
        "y": 2080,
        "wires": [
            [
                "9d84ea38e5210dd7"
            ],
            [
                "3ec3347d6067c419"
            ]
        ]
    },
    {
        "id": "3ec3347d6067c419",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "set pwok false",
        "rules": [
            {
                "t": "set",
                "p": "pwok",
                "pt": "global",
                "to": "false",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Map disabled",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "draggable",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 2100,
        "wires": [
            [
                "bab232ef7fa82868",
                "624f95947dc58e5f"
            ]
        ]
    },
    {
        "id": "be1a5ec559a8edde",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 2000,
        "wires": [
            [
                "d55c1ec10465de34"
            ]
        ]
    },
    {
        "id": "28df211206fb16e0",
        "type": "ui_toast",
        "z": "053268593fae8c42",
        "position": "top right",
        "displayTime": "2",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1340,
        "y": 2000,
        "wires": []
    },
    {
        "id": "ea43639de7a04cea",
        "type": "ui_button",
        "z": "053268593fae8c42",
        "name": "",
        "group": "102ceb2b72c23b34",
        "order": 2,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Disable",
        "tooltip": "",
        "color": "",
        "bgcolor": "red",
        "className": "",
        "icon": "fa-unlink",
        "payload": "false",
        "payloadType": "bool",
        "topic": "enabled",
        "topicType": "msg",
        "x": 480,
        "y": 2160,
        "wires": [
            [
                "0178fd4504665c1a",
                "d55c1ec10465de34"
            ]
        ]
    },
    {
        "id": "c1115a2bf9022cb5",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "timeout",
        "mode": "link",
        "links": [
            "920f18f7fde63004"
        ],
        "x": 1975,
        "y": 2000,
        "wires": []
    },
    {
        "id": "920f18f7fde63004",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "reset pwok",
        "links": [
            "c1115a2bf9022cb5"
        ],
        "x": 785,
        "y": 2120,
        "wires": [
            [
                "3ec3347d6067c419",
                "0178fd4504665c1a"
            ]
        ]
    },
    {
        "id": "e75ec8b1aa81a80d",
        "type": "ui_audio",
        "z": "053268593fae8c42",
        "name": "",
        "group": "52f0dbb4c9ed8309",
        "voice": "urn:moz-tts:sapi:Microsoft Zira Desktop - English (United States)?en-US",
        "always": true,
        "x": 1920,
        "y": 2080,
        "wires": []
    },
    {
        "id": "38e98b260a655b0e",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "\"timeout\"",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "timeout",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1880,
        "y": 2040,
        "wires": [
            [
                "e75ec8b1aa81a80d"
            ]
        ]
    },
    {
        "id": "2eb52eecf1e71e8b",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "countdown",
        "func": "num_mins = msg.timeout_mins;\nnum_secs = 60 * num_mins;\n\nm = {ui_control:{min:0,max:num_secs}}\nnode.send(m);\n\nglobal.set(\"map_pw_timeleft_secs\", num_secs);\n\n//for(let i=num_secs-1; i>=0; i--){\n//    setTimeout(function(){\n//    m = {\"payload\":i};\n//    node.send(m);\n//    }, (num_secs-i+1)*1000);\n//}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 2060,
        "wires": [
            [
                "05340e93def7b266"
            ]
        ]
    },
    {
        "id": "05340e93def7b266",
        "type": "ui_gauge",
        "z": "053268593fae8c42",
        "name": "",
        "group": "102ceb2b72c23b34",
        "order": 3,
        "width": 3,
        "height": 1,
        "gtype": "gage",
        "title": "",
        "label": "s",
        "format": "{{value}}",
        "min": 0,
        "max": "15",
        "colors": [
            "#ff0000",
            "#e6e600",
            "#80ff80"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1690,
        "y": 2040,
        "wires": []
    },
    {
        "id": "6247d3c32514cf3e",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "=0",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1860,
        "y": 2000,
        "wires": [
            [
                "38e98b260a655b0e",
                "c1115a2bf9022cb5"
            ]
        ]
    },
    {
        "id": "029cf5874fd028a5",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "timeleft",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "map_pw_timeleft_secs",
        "payloadType": "global",
        "x": 1560,
        "y": 2020,
        "wires": [
            [
                "05340e93def7b266",
                "a2b3c3a060d22110"
            ]
        ]
    },
    {
        "id": "a2b3c3a060d22110",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "decrement",
        "func": "r = global.get(\"map_pw_timeleft_secs\");\nif(r>=0){\n    r --;\n}\nglobal.set(\"map_pw_timeleft_secs\", r);\n\n\nreturn {\"payload\":r};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1710,
        "y": 2000,
        "wires": [
            [
                "6247d3c32514cf3e"
            ]
        ]
    },
    {
        "id": "dd9b8ed5c013799a",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "reset timer",
        "rules": [
            {
                "t": "set",
                "p": "map_pw_timeleft_secs",
                "pt": "global",
                "to": "-1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1550,
        "y": 2100,
        "wires": [
            []
        ]
    },
    {
        "id": "1389b54b1ebff7bb",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "set wps draggabiliy",
        "func": "wps = global.get(\"waypoints\");\nnew_wps = {}\nfor(var wp_name in wps){\n    wp = wps[wp_name];\n    wp.draggable = msg.draggable;\n    new_wps[wp_name] = wp;\n}\nglobal.set(\"waypoints\", new_wps);\nreturn {\"payload\":new_wps}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 2420,
        "wires": [
            [
                "50041808f3208548"
            ]
        ]
    },
    {
        "id": "9445ca58a93ea152",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "ask_pw_popup",
        "links": [
            "c75d8b8be81fe89b"
        ],
        "x": 35,
        "y": 2080,
        "wires": [
            [
                "e602c5202df1e782",
                "d55c1ec10465de34"
            ]
        ]
    },
    {
        "id": "c75d8b8be81fe89b",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "9445ca58a93ea152"
        ],
        "x": 615,
        "y": 1100,
        "wires": []
    },
    {
        "id": "f08a47ed118769f3",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "pwok_true",
        "mode": "link",
        "links": [
            "891af3daa0ae6f90",
            "0ab91e732def560c",
            "8de80de2eabfe326",
            "f682e02af47e8b56",
            "90a0dda9096a59fd",
            "0acc7386f78be75f",
            "2a5ad2f755ea0b9a",
            "0e046a83464d2a91",
            "735db8bb0cd0a42f",
            "d7c13a8b2c014042"
        ],
        "x": 1035,
        "y": 2040,
        "wires": []
    },
    {
        "id": "891af3daa0ae6f90",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "f08a47ed118769f3"
        ],
        "x": 1445,
        "y": 2060,
        "wires": [
            [
                "2eb52eecf1e71e8b"
            ]
        ]
    },
    {
        "id": "8de80de2eabfe326",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "f08a47ed118769f3"
        ],
        "x": 1125,
        "y": 2060,
        "wires": [
            [
                "e4507c760789e21f"
            ]
        ]
    },
    {
        "id": "f682e02af47e8b56",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "f08a47ed118769f3"
        ],
        "x": 1265,
        "y": 2400,
        "wires": [
            [
                "1389b54b1ebff7bb"
            ]
        ]
    },
    {
        "id": "bab232ef7fa82868",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "pwok_false",
        "mode": "link",
        "links": [
            "94dda05906aa624f",
            "22f5e52f436484c1",
            "51cb8dbb280a964e",
            "166e37e5141398e1",
            "38461b3fb77e1eb1",
            "3af2c4de239a81f6",
            "0e046a83464d2a91",
            "306a265baa490b08",
            "5f71a25149b27072"
        ],
        "x": 1045,
        "y": 2120,
        "wires": []
    },
    {
        "id": "94dda05906aa624f",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "bab232ef7fa82868"
        ],
        "x": 1265,
        "y": 2440,
        "wires": [
            [
                "1389b54b1ebff7bb"
            ]
        ]
    },
    {
        "id": "22f5e52f436484c1",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "bab232ef7fa82868"
        ],
        "x": 1445,
        "y": 2100,
        "wires": [
            [
                "dd9b8ed5c013799a"
            ]
        ]
    },
    {
        "id": "51cb8dbb280a964e",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "bab232ef7fa82868"
        ],
        "x": 1125,
        "y": 2100,
        "wires": [
            [
                "e4507c760789e21f"
            ]
        ]
    },
    {
        "id": "3f1101a0eff94520",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "select wp",
        "func": "wps = global.get(\"waypoints\");\nwp = wps[msg.payload.name];\n\nif(wp){\n    gs = global.get(\"gui_state\")\n    gs.selected_wp = wp\n    return {selected:wp.name}\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1180,
        "wires": [
            [
                "5e8a7b5813f43e9e"
            ]
        ]
    },
    {
        "id": "214ac3ccca3f6176",
        "type": "ui_form",
        "z": "053268593fae8c42",
        "name": "",
        "label": "WP Info",
        "group": "9dbddaa8775473fd",
        "order": 2,
        "width": 4,
        "height": 1,
        "options": [
            {
                "label": "Name",
                "value": "name",
                "type": "text",
                "required": false,
                "rows": null
            },
            {
                "label": "Depth",
                "value": "depth",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Spd | RPM",
                "value": "speed_control_mode",
                "type": "switch",
                "required": true,
                "rows": null
            },
            {
                "label": "Speed",
                "value": "speed",
                "type": "number",
                "required": false,
                "rows": null
            },
            {
                "label": "RPM",
                "value": "rpm",
                "type": "number",
                "required": false,
                "rows": null
            },
            {
                "label": "lat,lon",
                "value": "lat_lon",
                "type": "text",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "name": "",
            "depth": "",
            "speed_control_mode": false,
            "speed": "",
            "rpm": "",
            "lat_lon": ""
        },
        "payload": "",
        "submit": "Save",
        "cancel": "Clear",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 1520,
        "y": 1160,
        "wires": [
            [
                "77ca400a3f744748"
            ]
        ]
    },
    {
        "id": "fc3e3c9d40e35894",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "fill_wp_form",
        "func": "wps = global.get(\"waypoints\");\nswp = wps[msg.payload]\n\n\nif(swp){\n  form = {\n    \"name\":swp.name,\n    \"speed\":swp.travel_speed,\n    \"rpm\":swp.travel_rpm,\n    \"speed_control_mode\":swp.speed_control_mode==1,\n    \"depth\":swp.travel_depth,\n    \"lat_lon\":swp.lat+\",\"+swp.lon\n    };  \n\n}else{\n    form = {\n    \"name\":\"unknown\",\n    \"speed\":0,\n    \"rpm\":0,\n    \"speed_control_mode\":0,\n    \"depth\":0,\n    \"lat_lon\":\"0,0\"\n    };\n}\n\nm = {\"payload\":form}\nreturn m",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 1140,
        "wires": [
            [
                "214ac3ccca3f6176"
            ]
        ]
    },
    {
        "id": "c30f35ff507bcc2d",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "check pw",
        "props": [
            {
                "p": "enabled",
                "v": "pwok",
                "vt": "global"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1250,
        "y": 1180,
        "wires": [
            [
                "0641aa72216c69a0"
            ]
        ]
    },
    {
        "id": "0641aa72216c69a0",
        "type": "rbe",
        "z": "053268593fae8c42",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "enabled",
        "topi": "topic",
        "x": 1390,
        "y": 1180,
        "wires": [
            [
                "214ac3ccca3f6176"
            ]
        ]
    },
    {
        "id": "77ca400a3f744748",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "update wp details",
        "func": "wps = global.get(\"waypoints\");\newp = wps[msg.payload.name]\n\n\nif(ewp){\n    ewp.travel_depth = msg.payload.depth;\n    ewp.travel_rpm = msg.payload.rpm;\n    ewp.travel_speed = msg.payload.speed;\n    if(msg.payload.speed_control_mode){\n        ewp.speed_control_mode = 1 //rpm\n    }else{\n        ewp.speed_control_mode = 2 //m/s\n    }\n    // parse the lat lon into separate fields\n    latlon_list = msg.payload.lat_lon.split(\",\")\n    ewp.lat = parseFloat(latlon_list[0])\n    ewp.lon = parseFloat(latlon_list[1])\n    \n    \n    \n    wps[msg.payload.name] = ewp;\n}\nreturn {\"payload\":ewp.name};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 1200,
        "wires": [
            [
                "a4d0edd5f6d3f0a0",
                "584b9c424a1e9278"
            ]
        ]
    },
    {
        "id": "834ba7b8da81e656",
        "type": "ui_audio",
        "z": "053268593fae8c42",
        "name": "",
        "group": "52f0dbb4c9ed8309",
        "voice": "urn:moz-tts:sapi:Microsoft Zira Desktop - English (United States)?en-US",
        "always": "",
        "x": 1280,
        "y": 2120,
        "wires": []
    },
    {
        "id": "3af2c4de239a81f6",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "bab232ef7fa82868"
        ],
        "x": 35,
        "y": 2120,
        "wires": [
            [
                "6a6e48514015c5df"
            ]
        ]
    },
    {
        "id": "72ed74f562cb318d",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "empty payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 2120,
        "wires": [
            [
                "65555c354e02cfdc"
            ]
        ]
    },
    {
        "id": "06a8c629f9645980",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 160,
        "y": 2160,
        "wires": [
            [
                "72ed74f562cb318d"
            ]
        ]
    },
    {
        "id": "203068020888ce36",
        "type": "ui_dropdown",
        "z": "053268593fae8c42",
        "name": "",
        "label": "",
        "tooltip": "Select a WP to modify the details of",
        "place": "Select WP",
        "group": "9dbddaa8775473fd",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1340,
        "y": 1100,
        "wires": [
            [
                "fc3e3c9d40e35894",
                "ed39d8735dea7a7d"
            ]
        ]
    },
    {
        "id": "c943b10b45b886d8",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "list wp names",
        "func": "wps = global.get(\"waypoints\");\nreturn {\"options\":Object.keys(wps)};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 1060,
        "wires": [
            [
                "203068020888ce36"
            ]
        ]
    },
    {
        "id": "74385683b57e28cf",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1230,
        "y": 1020,
        "wires": [
            [
                "c943b10b45b886d8"
            ]
        ]
    },
    {
        "id": "dbfd8356d288e016",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "save_wps",
        "links": [
            "a4d0edd5f6d3f0a0",
            "c2a1d87a52c8ad5f",
            "e25583298eb669eb",
            "f361f910baa3973e"
        ],
        "x": 845,
        "y": 1020,
        "wires": [
            [
                "76e6c4863dc8bccd"
            ]
        ]
    },
    {
        "id": "dd7344e296dcc72d",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "make_wp_icon",
        "links": [
            "137e36108b790425",
            "5e8a7b5813f43e9e",
            "a4d0edd5f6d3f0a0",
            "c2a1d87a52c8ad5f",
            "f361f910baa3973e",
            "08be73627b96f7a9"
        ],
        "x": 45,
        "y": 100,
        "wires": [
            [
                "63e3ec36451352d2"
            ]
        ]
    },
    {
        "id": "c2a1d87a52c8ad5f",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "dbfd8356d288e016",
            "dd7344e296dcc72d"
        ],
        "x": 675,
        "y": 960,
        "wires": []
    },
    {
        "id": "a4d0edd5f6d3f0a0",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "dbfd8356d288e016",
            "dd7344e296dcc72d"
        ],
        "x": 1695,
        "y": 1180,
        "wires": []
    },
    {
        "id": "e25583298eb669eb",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "dbfd8356d288e016"
        ],
        "x": 1855,
        "y": 2360,
        "wires": []
    },
    {
        "id": "137e36108b790425",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "dd7344e296dcc72d"
        ],
        "x": 1855,
        "y": 2400,
        "wires": []
    },
    {
        "id": "0683e325bc09b55b",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "read_wp_db",
        "links": [
            "624f95947dc58e5f"
        ],
        "x": 1365,
        "y": 2320,
        "wires": [
            [
                "7964fafb17064262"
            ]
        ]
    },
    {
        "id": "624f95947dc58e5f",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "0683e325bc09b55b"
        ],
        "x": 1085,
        "y": 2080,
        "wires": []
    },
    {
        "id": "264b9e88b1732183",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "tracks",
        "links": [
            "30e3822ebf7d0303",
            "c5d05a53263ed5f1",
            "8044d7b5c55205ac",
            "7b64e449f6226ff4",
            "09e56f333fdbfc2d",
            "5d5faa63758bafc3"
        ],
        "x": 625,
        "y": 80,
        "wires": [
            [
                "1c9e33661e87e2a3"
            ]
        ]
    },
    {
        "id": "e4507c760789e21f",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "0.5",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1240,
        "y": 2080,
        "wires": [
            [
                "834ba7b8da81e656",
                "fe4d43a455cf7caa"
            ]
        ]
    },
    {
        "id": "2c83add42a3bdde3",
        "type": "split",
        "z": "053268593fae8c42",
        "name": "split vehicles",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "vehicle_name",
        "x": 210,
        "y": 360,
        "wires": [
            [
                "7f2cc14f03a77094",
                "f1433ab5d1a6ece3"
            ]
        ]
    },
    {
        "id": "520daee9221efb72",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "vehicles",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "vehicles",
        "payloadType": "global",
        "x": 180,
        "y": 320,
        "wires": [
            [
                "2c83add42a3bdde3"
            ]
        ]
    },
    {
        "id": "7f2cc14f03a77094",
        "type": "split",
        "z": "053268593fae8c42",
        "name": "split veh. fields",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "key",
        "x": 260,
        "y": 400,
        "wires": [
            [
                "2cc25083356d8871"
            ]
        ]
    },
    {
        "id": "2cc25083356d8871",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "key",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "basic_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "gps_fix",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "bt_state",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 330,
        "y": 460,
        "wires": [
            [
                "54110e815560e134"
            ],
            [
                "0e72ec8eee3e7b51"
            ],
            [
                "56b9b2bbfe507431"
            ]
        ]
    },
    {
        "id": "c00d8f6aa8f79659",
        "type": "ui_switch",
        "z": "053268593fae8c42",
        "name": "",
        "label": "Follow vehicle",
        "tooltip": "Re-center the map on the vehicle as it moves around",
        "group": "102ceb2b72c23b34",
        "order": 4,
        "width": 4,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 740,
        "y": 400,
        "wires": [
            [
                "b403e35eb5cac8c3"
            ]
        ]
    },
    {
        "id": "0aa6bd7787fe04f0",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "center_map_on_vehicle",
        "func": "vs = global.get(\"vehicles\");\nname = global.get(\"active_vehicle\");\nif(name in vs){\n    v = vs[name];\n    m = {\"payload\": {\n        \"command\":{\n            \"lat\": v.basic_state.lat,\n            \"lon\": v.basic_state.lon\n        }\n    }}\n    return m;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 400,
        "wires": [
            [
                "a695f0fb45d734a0"
            ]
        ]
    },
    {
        "id": "b403e35eb5cac8c3",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 890,
        "y": 400,
        "wires": [
            [
                "0aa6bd7787fe04f0"
            ]
        ]
    },
    {
        "id": "54110e815560e134",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "lat>0?",
        "property": "payload.lat",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0.05",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 420,
        "wires": [
            [
                "c00d8f6aa8f79659",
                "0fa2c8c468d4d8e5",
                "5d5faa63758bafc3"
            ]
        ]
    },
    {
        "id": "0fa2c8c468d4d8e5",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 675,
        "y": 460,
        "wires": []
    },
    {
        "id": "f1d43b7ac71a7066",
        "type": "rbe",
        "z": "053268593fae8c42",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 590,
        "y": 500,
        "wires": [
            [
                "0fa2c8c468d4d8e5",
                "5d5faa63758bafc3"
            ]
        ]
    },
    {
        "id": "0e72ec8eee3e7b51",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "lat>0?",
        "property": "payload.lat",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0.05",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 500,
        "wires": [
            [
                "f1d43b7ac71a7066"
            ]
        ]
    },
    {
        "id": "8368a65f786f7dcd",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 1415,
        "y": 400,
        "wires": []
    },
    {
        "id": "a695f0fb45d734a0",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "minute",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 1300,
        "y": 400,
        "wires": [
            [
                "8368a65f786f7dcd"
            ]
        ]
    },
    {
        "id": "1c9ea8600fae7e05",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "enable/disable marker r-click",
        "func": "pwok = global.get(\"pwok\");\nmsg.payload = {\"command\":{\n    \"hiderightclick\":!pwok,\n}}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 2140,
        "wires": [
            [
                "cf60302a5d14ae55"
            ]
        ]
    },
    {
        "id": "0e046a83464d2a91",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "bab232ef7fa82868",
            "f08a47ed118769f3"
        ],
        "x": 1445,
        "y": 2140,
        "wires": [
            [
                "1c9ea8600fae7e05"
            ]
        ]
    },
    {
        "id": "cf60302a5d14ae55",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 1755,
        "y": 2140,
        "wires": []
    },
    {
        "id": "0f02de0042b627c1",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "->name",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.name",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 1140,
        "wires": [
            [
                "fc3e3c9d40e35894"
            ]
        ]
    },
    {
        "id": "f1433ab5d1a6ece3",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "line to current_wp",
        "func": "basic_s = msg.payload.basic_state\nbt_s = msg.payload.bt_state\n\nname = basic_s.name\np1 = [basic_s.lat, basic_s.lon]\ntry{\n    p2 = [bt_s.current_wp.lat, bt_s.current_wp.lon]\n}catch{\n    return\n}\n\nline = {name:name + \"_target\",\n        layer: basic_s.layer,\n        line:[p1,p2],\n        color:\"orange\",\n        weight:2.5,\n        editable:false,\n        clickable:false,\n        dashArray:\"1,8\"\n}\n\nreturn {payload:line}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 320,
        "wires": [
            [
                "8df26b2177e029fc"
            ]
        ]
    },
    {
        "id": "8df26b2177e029fc",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 515,
        "y": 320,
        "wires": []
    },
    {
        "id": "5d6d95ba2130c00a",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "make_waypoint_icon",
        "func": "var icon = \"fa-eject\";\nif(msg.payload.travel_depth > 0){\n   icon = \"fa-arrow-down\";\n}\nif(msg.payload.travel_depth < 0){\n   icon = \"fa-arrow-up\";\n}\nif(msg.payload.travel_depth == 0){\n   icon = \"fa-strikethrough\";\n}\n\npopup = \"\"\nif(msg.payload.speed_control_mode == 1){\n    popup += msg.payload.travel_rpm + \" RPM<br>\"\n}else{\n    popup += msg.payload.travel_speed + \"m/s<br>\"\n}\n\nif(msg.payload.z_control_mode == 1){\n    popup += msg.payload.travel_depth + \" m depth<br>\"\n}else{\n    popup += msg.payload.travel_altitude + \" m altitude<br>\"\n}\n\n\ncolor = \"yellow\"\ngs = global.get(\"gui_state\");\nif(msg.payload.name == gs.selected_wp.name){\n   color = \"cyan\"\n}\n\n\nvar m = {\n    name:msg.payload.name,\n    label:msg.payload.name,\n    iconColor:color,\n    icon:icon,\n    draggable:true,\n    layer:\"Waypoints\",\n    lat:msg.payload.lat,\n    lon:msg.payload.lon,\n    depth:msg.payload.travel_depth,\n    alti:msg.payload.travel_altitude,\n    speed:msg.payload.travel_speed,\n    rpms:msg.payload.travel_rpm,\n    popup:popup,\n    popped:false\n}\n\nreturn {payload:m};\n    \n    ",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 220,
        "wires": [
            [
                "4f18c0fb5a5708dd"
            ]
        ]
    },
    {
        "id": "9f822780235be5cc",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "waypoints",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "waypoints",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 100,
        "wires": [
            [
                "d0142bd7055ffa41"
            ]
        ]
    },
    {
        "id": "d0142bd7055ffa41",
        "type": "split",
        "z": "053268593fae8c42",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 330,
        "y": 140,
        "wires": [
            [
                "a52d314697435418"
            ]
        ]
    },
    {
        "id": "5e8a7b5813f43e9e",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "dd7344e296dcc72d"
        ],
        "x": 535,
        "y": 1180,
        "wires": []
    },
    {
        "id": "22b33628c3c58200",
        "type": "ui_toast",
        "z": "053268593fae8c42",
        "position": "top right",
        "displayTime": "2",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "\"already exists\"",
        "x": 720,
        "y": 860,
        "wires": []
    },
    {
        "id": "a52d314697435418",
        "type": "rbe",
        "z": "053268593fae8c42",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 350,
        "y": 180,
        "wires": [
            [
                "5d6d95ba2130c00a"
            ]
        ]
    },
    {
        "id": "3c852826087dd02f",
        "type": "ui_switch",
        "z": "053268593fae8c42",
        "name": "plnng mode",
        "label": "Planning Mode",
        "tooltip": "ON: Clicking on the map will add the WP to the currently selected mission plan",
        "group": "574bd822e17b1c3f",
        "order": 9,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 1270,
        "y": 1860,
        "wires": [
            [
                "54592d18da8ed258"
            ]
        ]
    },
    {
        "id": "54592d18da8ed258",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "set G planning mode",
        "rules": [
            {
                "t": "set",
                "p": "gui_state.planning_mode",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1460,
        "y": 1860,
        "wires": [
            []
        ]
    },
    {
        "id": "32bd8cc69fc20aed",
        "type": "ui_list",
        "z": "053268593fae8c42",
        "group": "574bd822e17b1c3f",
        "name": "list of plans",
        "order": 6,
        "width": 7,
        "height": 5,
        "lineType": "three",
        "actionType": "click",
        "allowHTML": false,
        "outputs": 1,
        "topic": "",
        "x": 1350,
        "y": 1640,
        "wires": [
            [
                "9a013e31e30e32c9"
            ]
        ]
    },
    {
        "id": "ce5e1970adcba729",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "List mission plans",
        "func": "list = []\nplans = global.get(\"mission_plans\")\ng_wps = global.get(\"waypoints\")\ngui_state = global.get(\"gui_state\")\nselected_name = gui_state.selected_plan.name\n\nfor(const name in plans){\n    p = plans[name]\n    plan_item = {title:name}\n    if(selected_name == name){\n        plan_item.icon_name = 'fa-eye'\n    }\n    wp_names = p.wp_names\n    descr = \"\"\n    for(const wp_id in wp_names){\n        if(wp_id > 0){\n            descr += \" -> \"\n        }\n        try{\n            descr += g_wps[wp_names[wp_id]].name\n        }catch{\n            descr += wp_names[wp_id] + \"(?)\"\n        }\n    }\n    plan_item.description = descr\n    list.push(plan_item)\n}\nreturn {payload:list}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1640,
        "wires": [
            [
                "32bd8cc69fc20aed"
            ]
        ]
    },
    {
        "id": "9a013e31e30e32c9",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "select and return plan",
        "func": "gs = global.get(\"gui_state\")\nmplans = global.get(\"mission_plans\")\nmplan = mplans[msg.payload.title]\ngs.selected_plan = mplan\n\nreturn {payload:mplan}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 1640,
        "wires": [
            [
                "eb83eaebf50e928f"
            ]
        ]
    },
    {
        "id": "975505ece598254d",
        "type": "ui_text",
        "z": "053268593fae8c42",
        "group": "574bd822e17b1c3f",
        "order": 1,
        "width": 7,
        "height": 1,
        "name": "",
        "label": "Selected plan:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1420,
        "y": 1700,
        "wires": []
    },
    {
        "id": "3ec0329f836e4cca",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "nameof",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.name",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 1680,
        "wires": [
            [
                "975505ece598254d"
            ]
        ]
    },
    {
        "id": "8274f86612af6ff5",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "draw selected plan on map",
        "func": "wps = global.get(\"waypoints\")\nplans = global.get(\"mission_plans\")\ngui_state = global.get(\"gui_state\")\nif(!(gui_state.selected_plan)){\n    return null\n}\nplan = plans[gui_state.selected_plan.name]\n\nif(plan){\n    pts = []\n    for(const i in plan.wp_names){\n        wp_name = plan.wp_names[i]\n        wp = wps[wp_name]\n        try{\n            pts.push([wp.lat, wp.lon])\n        }catch{\n            // eh...\n        }\n    }\n    line = {name:\"selected_plan\",\n            layer:\"MissionPlan\",\n            line:pts,\n            color:\"cyan\",\n            weight:2.5,\n            editable:false,\n            clickable:false,\n            dashArray:\"5,5\"\n    }\n    \n    return {payload:line}\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 1600,
        "wires": [
            [
                "92f10e36cbc8e2ae"
            ]
        ]
    },
    {
        "id": "92f10e36cbc8e2ae",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 1355,
        "y": 1600,
        "wires": []
    },
    {
        "id": "a947c2e94adb46a7",
        "type": "ui_button",
        "z": "053268593fae8c42",
        "name": "",
        "group": "574bd822e17b1c3f",
        "order": 7,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "New plan",
        "tooltip": "Create a new empty mission plan, use planning mode to add WPs to it",
        "color": "",
        "bgcolor": "green",
        "className": "",
        "icon": "fa-map",
        "payload": "Enter a name for the new plan",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 160,
        "y": 1560,
        "wires": [
            [
                "c13b50f1d69e6267"
            ]
        ]
    },
    {
        "id": "24c5c8426e0521dd",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "add empty mission plan",
        "func": "plans = global.get(\"mission_plans\")\n\nplans[msg.payload] = {    \n    name:msg.payload,\n    wp_names:[]\n}\n\nreturn {payload:null}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 1640,
        "wires": [
            [
                "cc670b3fea45f7f4"
            ]
        ]
    },
    {
        "id": "5d4b8e531a20c041",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.2",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 730,
        "y": 1680,
        "wires": [
            [
                "cc670b3fea45f7f4"
            ]
        ]
    },
    {
        "id": "c13b50f1d69e6267",
        "type": "ui_toast",
        "z": "053268593fae8c42",
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 230,
        "y": 1600,
        "wires": [
            [
                "17e186169ef4980f"
            ]
        ]
    },
    {
        "id": "17e186169ef4980f",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Cancel",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 370,
        "y": 1600,
        "wires": [
            [],
            [
                "f011eaacb0688e5c"
            ]
        ]
    },
    {
        "id": "02bb6feb11b95e75",
        "type": "ui_list",
        "z": "053268593fae8c42",
        "group": "574bd822e17b1c3f",
        "name": "list of wps",
        "order": 10,
        "width": 7,
        "height": 9,
        "lineType": "three",
        "actionType": "menu",
        "allowHTML": false,
        "outputs": 1,
        "topic": "",
        "x": 1340,
        "y": 1560,
        "wires": [
            [
                "41b5dfe833d95518"
            ]
        ]
    },
    {
        "id": "80d32b7e64a0e969",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "make waypoint list",
        "func": "gs = global.get(\"gui_state\")\nif(!(gs.selected_plan)){\n    return null\n}\n\ngwps = global.get(\"waypoints\")\nswp_names = gs.selected_plan.wp_names\n\nlist_items = []\n\nfor(var i in swp_names){\n    wp_name = swp_names[i]\n    wp = gwps[wp_name]\n    \n    // title needs to be unique, otherwise\n    // we cant distinguish between repeated WPs in a plan\n    title = i + \" : \" + wp_name\n    \n    if(wp){\n        if(wp.travel_depth > 0){\n            icon = \"fa-arrow-down\";\n        }\n        if(wp.travel_depth < 0){\n            icon = \"fa-arrow-up\";\n        }\n        if(wp.travel_depth == 0){\n            icon = \"fa-strikethrough\";\n        }\n        \n        if(wp.speed_control_mode == 1){\n            descr = wp.travel_rpm + \" RPM, \"\n        }else{\n            descr = wp.travel_speed + \"m/s, \"\n        }\n        \n        if(wp.z_control_mode == 1){\n            descr +=wp.travel_depth + \" m depth\"\n        }else{\n            descr += wp.travel_altitude + \" m alti\"\n        }\n        \n        wp_item = {\n            title:title,\n            description:descr,\n            icon_name:icon\n        }\n    }else{\n        wp_item = {\n            title:title+\"(?)\",\n            description:\"unknown wp\",\n            icon_name:\"fa-question\"\n        }\n    }\n    wp_item.menu = [\"Delete\", \"Move up\", \"Move down\"]\n    list_items.push(wp_item)\n}\n\nreturn {payload:list_items}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1560,
        "wires": [
            [
                "02bb6feb11b95e75"
            ]
        ]
    },
    {
        "id": "efb303bf3091ae28",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "planning mode?",
        "property": "gui_state.planning_mode",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 460,
        "y": 1220,
        "wires": [
            [
                "38892f3fc3f9c01f"
            ]
        ]
    },
    {
        "id": "38892f3fc3f9c01f",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "add wp to selected plan",
        "func": "wps = global.get(\"waypoints\")\nwp = wps[msg.payload.name]\n\ngs = global.get(\"gui_state\")\n\nnode.warn(\"adding wp?\")\ngs.selected_plan.wp_names.push(wp.name)\n\n\nreturn {payload:gs.selected_plan.name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 1220,
        "wires": [
            [
                "23cae1380a7e60df"
            ]
        ]
    },
    {
        "id": "54fb9d3ca092bf2f",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "enabled",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "false",
        "payloadType": "jsonata",
        "x": 1110,
        "y": 1860,
        "wires": [
            [
                "3c852826087dd02f",
                "d27bc1c16d11bdae"
            ]
        ]
    },
    {
        "id": "41b5dfe833d95518",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "modify plan",
        "func": "parts = msg.payload.title.split(\" : \")\nindex = parseInt(parts[0])\nname = parts[1]\n\n\naction = msg.payload.selected\n\ngui_state = global.get(\"gui_state\")\nselected_plan = gui_state.selected_plan\n\naffected_wp_name = selected_plan.wp_names[0]\n\nswitch(action){\n    case \"Delete\":\n        deleted = selected_plan.wp_names.splice(index,1)\n        break\n    case \"Move up\":\n        // swap with index-1\n        if(index >= 1){\n            temp = selected_plan.wp_names[index-1]\n            selected_plan.wp_names[index-1] = selected_plan.wp_names[index]\n            selected_plan.wp_names[index] = temp\n        }\n        break\n    case \"Move down\":\n        // swap with index+1\n        if(index < selected_plan.wp_names.length){\n            temp = selected_plan.wp_names[index+1]\n            selected_plan.wp_names[index+1] = selected_plan.wp_names[index]\n            selected_plan.wp_names[index] = temp\n        }\n        break\n}\n\nreturn {payload:null}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 1560,
        "wires": [
            [
                "154fa47a92c360fa"
            ]
        ]
    },
    {
        "id": "f5866b2daa9f585f",
        "type": "comment",
        "z": "053268593fae8c42",
        "name": "this prevents an infinte loop?",
        "info": "",
        "x": 1280,
        "y": 980,
        "wires": []
    },
    {
        "id": "3bb272bc24f28449",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "update_plans_in_gui",
        "links": [
            "23cae1380a7e60df",
            "154fa47a92c360fa",
            "eb83eaebf50e928f",
            "cc670b3fea45f7f4",
            "c23cb78714756aea",
            "073be28f85ca8d84",
            "584b9c424a1e9278",
            "9219571f4cc06895"
        ],
        "x": 1025,
        "y": 1660,
        "wires": [
            [
                "80d32b7e64a0e969",
                "8274f86612af6ff5",
                "ce5e1970adcba729",
                "10ae7fa4e2f02829",
                "fc28244fe5dc2758"
            ]
        ]
    },
    {
        "id": "23cae1380a7e60df",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 815,
        "y": 1220,
        "wires": []
    },
    {
        "id": "154fa47a92c360fa",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 1595,
        "y": 1560,
        "wires": []
    },
    {
        "id": "eb83eaebf50e928f",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 1705,
        "y": 1640,
        "wires": []
    },
    {
        "id": "cc670b3fea45f7f4",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 815,
        "y": 1660,
        "wires": []
    },
    {
        "id": "bbdcfc8d9896be61",
        "type": "ui_button",
        "z": "053268593fae8c42",
        "name": "",
        "group": "574bd822e17b1c3f",
        "order": 8,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Delete",
        "tooltip": "",
        "color": "",
        "bgcolor": "red",
        "className": "",
        "icon": "fa-trash",
        "payload": "Are you sure?",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 250,
        "y": 1800,
        "wires": [
            [
                "2587760c6ccd7ee9"
            ]
        ]
    },
    {
        "id": "2587760c6ccd7ee9",
        "type": "ui_toast",
        "z": "053268593fae8c42",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "Yes",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 290,
        "y": 1840,
        "wires": [
            [
                "f78ba83f81dcab8b"
            ]
        ]
    },
    {
        "id": "f78ba83f81dcab8b",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Cancel",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 1840,
        "wires": [
            [],
            [
                "6b8ed8a3ec84bf81"
            ]
        ]
    },
    {
        "id": "6b8ed8a3ec84bf81",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "delete selected plan",
        "func": "plans = global.get(\"mission_plans\")\ngui_state = global.get(\"gui_state\")\nselected = gui_state.selected_plan\n\ngui_state.selected_plan = null\ndelete plans[selected.name]\n\nreturn {payload:null}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1880,
        "wires": [
            [
                "c23cb78714756aea"
            ]
        ]
    },
    {
        "id": "c23cb78714756aea",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 675,
        "y": 1880,
        "wires": []
    },
    {
        "id": "10ae7fa4e2f02829",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1130,
        "y": 1700,
        "wires": [
            [
                "3ec0329f836e4cca"
            ],
            [
                "e0d54c26f2a24952"
            ]
        ]
    },
    {
        "id": "e0d54c26f2a24952",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "none",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "<NONE>",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 1720,
        "wires": [
            [
                "975505ece598254d"
            ]
        ]
    },
    {
        "id": "073be28f85ca8d84",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449"
        ],
        "x": 675,
        "y": 1020,
        "wires": []
    },
    {
        "id": "584b9c424a1e9278",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 1695,
        "y": 1220,
        "wires": []
    },
    {
        "id": "f011eaacb0688e5c",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "mission_plans",
        "propertyType": "global",
        "rules": [
            {
                "t": "hask",
                "v": "payload",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 1640,
        "wires": [
            [
                "4240a0e4c4ab6663"
            ],
            [
                "24c5c8426e0521dd"
            ]
        ]
    },
    {
        "id": "4240a0e4c4ab6663",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "Reset plan?",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Reset plan?",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 1520,
        "wires": [
            [
                "abd8e5c1d6660c95"
            ]
        ]
    },
    {
        "id": "abd8e5c1d6660c95",
        "type": "ui_toast",
        "z": "053268593fae8c42",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "Reset plan",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 550,
        "y": 1560,
        "wires": [
            [
                "967894d02181c3ab"
            ]
        ]
    },
    {
        "id": "967894d02181c3ab",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Cancel",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 1600,
        "wires": [
            [],
            [
                "24c5c8426e0521dd"
            ]
        ]
    },
    {
        "id": "50bcdfd5a4dd1e73",
        "type": "key-value-write",
        "z": "053268593fae8c42",
        "store": "99b5f7c7e1f62814",
        "action": "set",
        "key": "mission_plans",
        "keyvalue": "",
        "name": "save plans",
        "x": 1270,
        "y": 1760,
        "wires": [
            []
        ]
    },
    {
        "id": "d27bc1c16d11bdae",
        "type": "key-value-read",
        "z": "053268593fae8c42",
        "store": "99b5f7c7e1f62814",
        "key": "mission_plans",
        "name": "read plans",
        "x": 1270,
        "y": 1820,
        "wires": [
            [
                "e1628432fd9095d1"
            ]
        ]
    },
    {
        "id": "e1628432fd9095d1",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "set mission plans",
        "rules": [
            {
                "t": "set",
                "p": "mission_plans",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1450,
        "y": 1820,
        "wires": [
            [
                "9219571f4cc06895"
            ]
        ]
    },
    {
        "id": "9219571f4cc06895",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "3bb272bc24f28449",
            "cfae73f99e2134fa"
        ],
        "x": 1575,
        "y": 1820,
        "wires": []
    },
    {
        "id": "fc28244fe5dc2758",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "plans",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "mission_plans",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1130,
        "y": 1760,
        "wires": [
            [
                "50bcdfd5a4dd1e73"
            ]
        ]
    },
    {
        "id": "6be233359c49e07c",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "7f714df460627f98",
            "69e7c18a81f1b55b"
        ],
        "x": 65,
        "y": 1560,
        "wires": [
            [
                "a947c2e94adb46a7"
            ]
        ]
    },
    {
        "id": "80d6287c45de6bfd",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "7f714df460627f98",
            "69e7c18a81f1b55b"
        ],
        "x": 165,
        "y": 1800,
        "wires": [
            [
                "bbdcfc8d9896be61"
            ]
        ]
    },
    {
        "id": "57522fb44699f76c",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "7f714df460627f98",
            "69e7c18a81f1b55b"
        ],
        "x": 1145,
        "y": 1900,
        "wires": [
            [
                "3c852826087dd02f"
            ]
        ]
    },
    {
        "id": "3a1f387033d536c4",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "08424e560c7a93a0",
            "3689a5d35bef9b91"
        ],
        "x": 1245,
        "y": 1520,
        "wires": [
            [
                "02bb6feb11b95e75"
            ]
        ]
    },
    {
        "id": "43d1411ba4b74c6a",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "disable on startup",
        "props": [
            {
                "p": "enabled",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "jsonata",
        "x": 390,
        "y": 2440,
        "wires": [
            [
                "69e7c18a81f1b55b"
            ]
        ]
    },
    {
        "id": "b58b554b9b7f6d41",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "check",
        "props": [
            {
                "p": "enabled",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 120,
        "y": 2380,
        "wires": [
            [
                "f7a8f0eb207edea5"
            ]
        ]
    },
    {
        "id": "f7a8f0eb207edea5",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "pw?",
        "property": "pwok",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 2380,
        "wires": [
            [
                "25340677e61fe9f8"
            ],
            [
                "ea15ee49ae9cef2d"
            ]
        ]
    },
    {
        "id": "25340677e61fe9f8",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "enable",
        "rules": [
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "true",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2360,
        "wires": [
            [
                "69e7c18a81f1b55b"
            ]
        ]
    },
    {
        "id": "ea15ee49ae9cef2d",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "disable, turn off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "false",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 2400,
        "wires": [
            [
                "69e7c18a81f1b55b"
            ]
        ]
    },
    {
        "id": "69e7c18a81f1b55b",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "password_enable/disable buttons",
        "mode": "link",
        "links": [
            "57522fb44699f76c",
            "6be233359c49e07c",
            "80d6287c45de6bfd",
            "263274d293ee9948",
            "0524ef035c7f07a6",
            "e8e2232722bf1c53",
            "31078d5c1f2c258e",
            "621f6f51348de540",
            "52a61453cb205ade"
        ],
        "x": 555,
        "y": 2400,
        "wires": []
    },
    {
        "id": "3689a5d35bef9b91",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "password_enable/disable forms",
        "mode": "link",
        "links": [
            "3a1f387033d536c4"
        ],
        "x": 1055,
        "y": 2180,
        "wires": []
    },
    {
        "id": "83e804f15e3b47ed",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy",
        "props": [
            {
                "p": "enabled",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 710,
        "y": 2220,
        "wires": [
            [
                "0178fd4504665c1a"
            ]
        ]
    },
    {
        "id": "d7c13a8b2c014042",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "",
        "links": [
            "f08a47ed118769f3"
        ],
        "x": 825,
        "y": 2220,
        "wires": [
            [
                "bf0893aa3153bd28"
            ]
        ]
    },
    {
        "id": "0178fd4504665c1a",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "enabled false",
        "func": "return {enabled:false}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 2180,
        "wires": [
            [
                "3689a5d35bef9b91"
            ]
        ]
    },
    {
        "id": "bf0893aa3153bd28",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "enabled true",
        "func": "return {enabled:true}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 2220,
        "wires": [
            [
                "3689a5d35bef9b91",
                "e1efa0ab37a525e1"
            ]
        ]
    },
    {
        "id": "739887f18150422f",
        "type": "comment",
        "z": "053268593fae8c42",
        "name": "functions, because i dont want payloads and such here, just the enabled signal",
        "info": "",
        "x": 830,
        "y": 2260,
        "wires": []
    },
    {
        "id": "5fa0a01fe9fd0b6a",
        "type": "ui_dropdown",
        "z": "053268593fae8c42",
        "name": "vehicle_select",
        "label": "Vehicle",
        "tooltip": "Select a vehicle to control and stuff",
        "place": "Select a vehicle",
        "group": "1417de57d250f31f",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 220,
        "y": 2640,
        "wires": [
            [
                "cc4c4f87612a2c55"
            ]
        ]
    },
    {
        "id": "cc4c4f87612a2c55",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "set active vehicle",
        "rules": [
            {
                "t": "set",
                "p": "active_vehicle",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 2680,
        "wires": [
            []
        ]
    },
    {
        "id": "014a2eed30078dbd",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 2560,
        "wires": [
            [
                "aa9a2c14dd1b54d6"
            ]
        ]
    },
    {
        "id": "aa9a2c14dd1b54d6",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "vehicle_names",
        "func": "vs = global.get(\"vehicles\")\nnames = Object.keys(vs)\nactive_names = []\nfor(var v_name of names){\n    v = vs[v_name]\n    if(v.bt_state.last_heartbeat){\n        active_names.push(v.basic_state.name)\n    }\n}\nreturn {options:active_names}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 2600,
        "wires": [
            [
                "5fa0a01fe9fd0b6a"
            ]
        ]
    },
    {
        "id": "56b9b2bbfe507431",
        "type": "split",
        "z": "053268593fae8c42",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "key",
        "x": 470,
        "y": 620,
        "wires": [
            [
                "c403355878a0b092"
            ]
        ]
    },
    {
        "id": "c403355878a0b092",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "",
        "property": "key",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "current_plan",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "current_wp",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 590,
        "y": 620,
        "wires": [
            [
                "516a5f3a55a9fa1a"
            ],
            [],
            []
        ]
    },
    {
        "id": "9bf83a1ca45f0473",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "lines for current plan",
        "func": "wps = msg.payload.waypoints\npoints = []\nfor(var i in wps){\n        points.push([wps[i].lat, wps[i].lon])\n}\n\nswitch(msg.payload.plan_state){\n    case 0: //running\n        c = \"orange\"\n        w = 2\n        break\n    case 1: // stopped\n        c = \"red\"\n        w = 1\n        break\n    case 2: // paused\n        c = \"orange\"\n        w = 1\n        break\n    case 3: // emergency\n        c = \"red\"\n        w = 0.1\n        break\n    case 4: // received\n        c = \"yellow\"\n        w = 2\n        break\n}\n\nline = {name: msg.vehicle_name+\"_current_plan\",\n        layer: msg.vehicle_name,\n        line:points,\n        color:c,\n        weight:w,\n        editable:false,\n        clickable:false,\n        dashArray:\"1,8,5,8\"\n}\nreturn {payload:line}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 600,
        "wires": [
            [
                "fe6676f1a71e7f3c"
            ]
        ]
    },
    {
        "id": "fe6676f1a71e7f3c",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 1035,
        "y": 600,
        "wires": []
    },
    {
        "id": "5d5faa63758bafc3",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "264b9e88b1732183"
        ],
        "x": 745,
        "y": 460,
        "wires": []
    },
    {
        "id": "516a5f3a55a9fa1a",
        "type": "rbe",
        "z": "053268593fae8c42",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 730,
        "y": 600,
        "wires": [
            [
                "9bf83a1ca45f0473"
            ]
        ]
    },
    {
        "id": "0ffddf9874f15a8e",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "disable_button",
        "links": [
            "6a1f8dffeaecbbdf",
            "e1efa0ab37a525e1"
        ],
        "x": 385,
        "y": 2160,
        "wires": [
            [
                "ea43639de7a04cea"
            ]
        ]
    },
    {
        "id": "e1efa0ab37a525e1",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "disable_disable",
        "mode": "link",
        "links": [
            "0ffddf9874f15a8e"
        ],
        "x": 1055,
        "y": 2220,
        "wires": []
    },
    {
        "id": "f0807890835d67b1",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "center_map_on_active_veh",
        "links": [
            "07a1bbac5d3ab58e"
        ],
        "x": 925,
        "y": 360,
        "wires": [
            [
                "0aa6bd7787fe04f0"
            ]
        ]
    },
    {
        "id": "6a6e48514015c5df",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 2120,
        "wires": [
            [
                "72ed74f562cb318d"
            ]
        ]
    },
    {
        "id": "d55c1ec10465de34",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "to pw check",
        "mode": "link",
        "links": [
            "8b6b68495542c5ee"
        ],
        "x": 605,
        "y": 2100,
        "wires": []
    },
    {
        "id": "8b6b68495542c5ee",
        "type": "link in",
        "z": "053268593fae8c42",
        "name": "pw check",
        "links": [
            "d55c1ec10465de34"
        ],
        "x": 605,
        "y": 2040,
        "wires": [
            [
                "db1ccf5a30da00f2"
            ]
        ]
    },
    {
        "id": "db1ccf5a30da00f2",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 710,
        "y": 2040,
        "wires": [
            [
                "b7c3154386a72406"
            ]
        ]
    },
    {
        "id": "63e3ec36451352d2",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 100,
        "wires": [
            [
                "9f822780235be5cc"
            ]
        ]
    },
    {
        "id": "e48b9fee7192cb74",
        "type": "ui_switch",
        "z": "053268593fae8c42",
        "name": "",
        "label": "Draw tracks",
        "tooltip": "This will increase download rates for everyone!",
        "group": "102ceb2b72c23b34",
        "order": 5,
        "width": 5,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 610,
        "y": 40,
        "wires": [
            [
                "d4f2e6688f0fac02"
            ]
        ]
    },
    {
        "id": "528f627a90f6985c",
        "type": "switch",
        "z": "053268593fae8c42",
        "name": "draw_tracks?",
        "property": "gui_state.draw_tracks",
        "propertyType": "global",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 850,
        "y": 80,
        "wires": [
            [
                "6ff93a577bba20e1"
            ]
        ]
    },
    {
        "id": "d4f2e6688f0fac02",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "set gui_state.draw_tracks",
        "rules": [
            {
                "t": "set",
                "p": "gui_state.draw_tracks",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6ff93a577bba20e1",
        "type": "delay",
        "z": "053268593fae8c42",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "0.2",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 900,
        "y": 120,
        "wires": [
            [
                "4f18c0fb5a5708dd"
            ]
        ]
    },
    {
        "id": "fe4d43a455cf7caa",
        "type": "change",
        "z": "053268593fae8c42",
        "name": "empty topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1290,
        "y": 2040,
        "wires": [
            [
                "28df211206fb16e0"
            ]
        ]
    },
    {
        "id": "cbdcee08271b0f6d",
        "type": "ui_button",
        "z": "053268593fae8c42",
        "name": "",
        "group": "9dbddaa8775473fd",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Center in map",
        "tooltip": "Center map on selected WP",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1740,
        "y": 1060,
        "wires": [
            [
                "d88ab4d85af725de"
            ]
        ]
    },
    {
        "id": "d88ab4d85af725de",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "center on selected_wp",
        "func": "gui_state = global.get(\"gui_state\")\nswp = gui_state.selected_wp\n\n\nm = {\"payload\": {\n        \"command\":{\n            \"lat\": swp.lat,\n            \"lon\": swp.lon\n        }\n    }}\nreturn m;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1800,
        "y": 1100,
        "wires": [
            [
                "e6fb258dd75c7fb6"
            ]
        ]
    },
    {
        "id": "e6fb258dd75c7fb6",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "worldmap",
        "mode": "link",
        "links": [
            "baf8ce41441c9d88"
        ],
        "x": 1925,
        "y": 1060,
        "wires": []
    },
    {
        "id": "ed39d8735dea7a7d",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "set selected_wp",
        "func": "gui_state = global.get(\"gui_state\")\nwps = global.get(\"waypoints\")\n\nswp = wps[msg.payload]\ngui_state.selected_wp = swp\nreturn {selected:swp.name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 1100,
        "wires": [
            [
                "08be73627b96f7a9"
            ]
        ]
    },
    {
        "id": "35c02c549ee1fceb",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "num",
        "x": 1090,
        "y": 1060,
        "wires": [
            [
                "c943b10b45b886d8"
            ]
        ]
    },
    {
        "id": "08be73627b96f7a9",
        "type": "link out",
        "z": "053268593fae8c42",
        "name": "",
        "mode": "link",
        "links": [
            "dd7344e296dcc72d"
        ],
        "x": 1655,
        "y": 1100,
        "wires": []
    },
    {
        "id": "d30c28fa7b54aaac",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy 1s",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 1160,
        "y": 80,
        "wires": [
            [
                "9ed8b9724ce7aa14"
            ]
        ]
    },
    {
        "id": "9ed8b9724ce7aa14",
        "type": "function",
        "z": "053268593fae8c42",
        "name": "make new base layer",
        "func": "msg = {payload:{command:{}}};\n// msg.payload.command.map = {\n//     \"name\":\"SWE-Chart\",\n//     \"url\":\"https://pasjon.eniro.se/#map={z}/{x}/{y}.png\",\n//     \"opt\":{ \"maxZoom\":22, \"attribution\":\"&copy; Eniro\" }\n// };\n\n\n\n\n// msg.payload.command.map = {\n//     \"name\":\"EMODnetBathy\", \n//     \"url\":\"https://ows.emodnet-bathymetry.eu/wms\",\n//     \"opt\":{ \"maxZoom\":22,\n//             \"attribution\":\"&copy; EMODnet\",\n//             \"format\":\"image/png\",\n//             \"layers\":\"mean_multicolour\"\n//     },\n//     \"wms\":true\n// };\n\n// this works as a http request from this container\n// http://mapserver/?MAP=/etc/mapserver/sweden.map&SERVICE=WMS&REQUEST=Getmap&VERSION=1.1.1&LAYERS=CONTOUR&srs=EPSG:4326&BBOX=9.0,54.0,26.0,69.0&FORMAT=png&WIDTH=2000&HEIGHT=1100&STYLES=default\nmsg.payload.command.map = {\n    \"overlay\":\"Bathy\", \n    \"url\":\"http://nodered.blue-robots.com/mapserver\",\n    \"opt\":{ \n        \"map\":\"/etc/mapserver/sweden.map\",\n        \"layers\":\"CONTOUR\",\n        \"format\":\"image/png\",\n        \"service\":\"wms\",\n        \"transparent\":true\n    },\n    \"wms\":true\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 80,
        "wires": [
            [
                "4f18c0fb5a5708dd",
                "a31946469861cdfe"
            ]
        ]
    },
    {
        "id": "42b3be555d274617",
        "type": "inject",
        "z": "053268593fae8c42",
        "name": "deploy",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "9f822780235be5cc"
            ]
        ]
    },
    {
        "id": "a31946469861cdfe",
        "type": "debug",
        "z": "053268593fae8c42",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1550,
        "y": 160,
        "wires": []
    },
    {
        "id": "6ef706bf96c3bc5d",
        "type": "function",
        "z": "bd7de6c3e385f05f",
        "name": "increment disable count",
        "func": "r = global.get(\"disable_count\");\nr ++;\nglobal.set(\"disable_count\", r);\n\n\nif(r%20 == 0){\n    return {\"payload\":\"thatsenough\"};\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 140,
        "wires": [
            [
                "97d0c84d2b1a91da"
            ]
        ]
    },
    {
        "id": "97d0c84d2b1a91da",
        "type": "switch",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "property": "disable_count",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "20",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "30",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "40",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 590,
        "y": 140,
        "wires": [
            [
                "b6e91a4522354871"
            ],
            [
                "0d67abcb7ba85ce3"
            ],
            [
                "31ad09d9905e3658"
            ]
        ]
    },
    {
        "id": "b6e91a4522354871",
        "type": "change",
        "z": "bd7de6c3e385f05f",
        "name": "navy seal",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "I would read you the entire navy seal copy pasta if I wasn't tamed a little. Consider yourself lucky!",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 100,
        "wires": [
            [
                "05b65ee59cc1ade5"
            ]
        ]
    },
    {
        "id": "05b65ee59cc1ade5",
        "type": "ui_audio",
        "z": "bd7de6c3e385f05f",
        "d": true,
        "name": "",
        "group": "52f0dbb4c9ed8309",
        "voice": "urn:moz-tts:sapi:Microsoft Zira Desktop - English (United States)?en-US",
        "always": "",
        "x": 980,
        "y": 140,
        "wires": []
    },
    {
        "id": "559c9f52a6df82fb",
        "type": "function",
        "z": "bd7de6c3e385f05f",
        "name": "reset enough count?",
        "func": "\nglobal.set(\"disable_count\", 0);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "38c7a0234b03c09b",
        "type": "comment",
        "z": "bd7de6c3e385f05f",
        "name": "easter egg",
        "info": "",
        "x": 160,
        "y": 160,
        "wires": []
    },
    {
        "id": "735db8bb0cd0a42f",
        "type": "link in",
        "z": "bd7de6c3e385f05f",
        "d": true,
        "name": "",
        "links": [
            "f08a47ed118769f3"
        ],
        "x": 265,
        "y": 180,
        "wires": [
            [
                "559c9f52a6df82fb"
            ]
        ]
    },
    {
        "id": "306a265baa490b08",
        "type": "link in",
        "z": "bd7de6c3e385f05f",
        "d": true,
        "name": "",
        "links": [
            "bab232ef7fa82868"
        ],
        "x": 265,
        "y": 140,
        "wires": [
            [
                "6ef706bf96c3bc5d"
            ]
        ]
    },
    {
        "id": "4883b3b5db86634e",
        "type": "http request",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "nodered.blue-robots.com",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "senderr": false,
        "x": 430,
        "y": 400,
        "wires": [
            [
                "9c952b35afe52c7e"
            ]
        ]
    },
    {
        "id": "de88b118f331d16e",
        "type": "inject",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "deploy",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 480,
        "wires": [
            [
                "4883b3b5db86634e"
            ]
        ]
    },
    {
        "id": "9c952b35afe52c7e",
        "type": "switch",
        "z": "bd7de6c3e385f05f",
        "name": "cannot get /?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "Cannot GET /",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 400,
        "wires": [
            [
                "accdcf3a24aed5c5"
            ],
            [
                "642380897225ef31"
            ]
        ]
    },
    {
        "id": "f8984d76cbfd5967",
        "type": "ui_led",
        "z": "bd7de6c3e385f05f",
        "order": 8,
        "group": "9dbddaa8775473fd",
        "width": 4,
        "height": 1,
        "label": "F5?",
        "labelPlacement": "left",
        "labelAlignment": "right",
        "colorForValue": [
            {
                "color": "#ff0000",
                "value": "false",
                "valueType": "bool"
            },
            {
                "color": "#008000",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "allowColorForValueInMessage": false,
        "shape": "circle",
        "showGlow": true,
        "name": "f5?",
        "x": 930,
        "y": 400,
        "wires": []
    },
    {
        "id": "accdcf3a24aed5c5",
        "type": "change",
        "z": "bd7de6c3e385f05f",
        "name": "cant :(",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "http",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 380,
        "wires": [
            [
                "f8984d76cbfd5967",
                "9698a4e720d89bc4"
            ]
        ]
    },
    {
        "id": "642380897225ef31",
        "type": "change",
        "z": "bd7de6c3e385f05f",
        "name": "can :)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "http",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 420,
        "wires": [
            [
                "f8984d76cbfd5967",
                "9698a4e720d89bc4"
            ]
        ]
    },
    {
        "id": "9698a4e720d89bc4",
        "type": "debug",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 320,
        "wires": []
    },
    {
        "id": "4de56f10827f5127",
        "type": "ui_ui_control",
        "z": "bd7de6c3e385f05f",
        "d": true,
        "name": "connection?",
        "events": "connect",
        "x": 230,
        "y": 560,
        "wires": [
            [
                "4883b3b5db86634e",
                "0fb1ad03ef52c031",
                "9811d075c2958931"
            ]
        ]
    },
    {
        "id": "0fb1ad03ef52c031",
        "type": "debug",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 720,
        "wires": []
    },
    {
        "id": "9811d075c2958931",
        "type": "change",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "new_connect",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "cefa3896251d42e3",
        "type": "inject",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "0 6-22 * * *",
        "once": false,
        "onceDelay": "1",
        "topic": "regular",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 440,
        "wires": [
            [
                "4883b3b5db86634e"
            ]
        ]
    },
    {
        "id": "0d67abcb7ba85ce3",
        "type": "change",
        "z": "bd7de6c3e385f05f",
        "name": "disable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "No seriously, stop it. I will disable the button if you keep this up.",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 140,
        "wires": [
            [
                "05b65ee59cc1ade5"
            ]
        ]
    },
    {
        "id": "31ad09d9905e3658",
        "type": "change",
        "z": "bd7de6c3e385f05f",
        "name": "disabled",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Okay, no more button for you. Disable disabled until further notice.",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 180,
        "wires": [
            [
                "05b65ee59cc1ade5",
                "6a1f8dffeaecbbdf"
            ]
        ]
    },
    {
        "id": "6a1f8dffeaecbbdf",
        "type": "link out",
        "z": "bd7de6c3e385f05f",
        "name": "disable_disable",
        "mode": "link",
        "links": [
            "0ffddf9874f15a8e"
        ],
        "x": 925,
        "y": 200,
        "wires": []
    },
    {
        "id": "ce2b69173c28d8d1",
        "type": "http request",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://mapserver/?MAP=/etc/mapserver/sweden.map&SERVICE=WMS&REQUEST=Getmap&VERSION=1.1.1&LAYERS=CONTOUR&srs=EPSG:4326&BBOX=9.0,54.0,26.0,69.0&FORMAT=png&WIDTH=2000&HEIGHT=1100&STYLES=default",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 810,
        "y": 800,
        "wires": [
            [
                "90c9f56afdfc8620"
            ]
        ]
    },
    {
        "id": "1aac06b73691a3f2",
        "type": "inject",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 620,
        "y": 800,
        "wires": [
            [
                "ce2b69173c28d8d1"
            ]
        ]
    },
    {
        "id": "90c9f56afdfc8620",
        "type": "debug",
        "z": "bd7de6c3e385f05f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 800,
        "wires": []
    },
    {
        "id": "a04b59e608979f6a",
        "type": "ui_list",
        "z": "072468ee5a218dc0",
        "group": "a48b13904097fb6a",
        "name": "List of robots",
        "order": 1,
        "width": 6,
        "height": 1,
        "lineType": "two",
        "actionType": "click",
        "allowHTML": false,
        "outputs": 1,
        "topic": "",
        "x": 630,
        "y": 1060,
        "wires": [
            [
                "8d60954c80270a11"
            ]
        ]
    },
    {
        "id": "b17ab9737c48ebe8",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "make ui_list config from robot_states",
        "func": "list_config = []\nrobot_states = global.get(\"robot_states\")\nfor(const robot_name in robot_states){\n    robot_state = robot_states[robot_name]\n    since_last_update = (Date.now() - robot_state.last_update)/1000\n    \n    if(since_last_update > 10*60){\n        description_str = \" >10m ago\"\n    }else{\n        description_str = \" \"+ since_last_update.toFixed(2) + \"s ago\"\n    }\n    \n    \n    if(since_last_update > 10*60){\n        icon = 'fa-deaf'\n    }else{\n        icon = 'fa-feed'\n    }\n    \n    if(robot_state.gui.selected){\n        icon = 'fa-eye'\n    }\n    \n    \n    list_item = {\n        title: robot_name,\n        description: description_str,\n        icon_name: icon\n    }\n    list_config.push(list_item)\n}\nreturn {payload:list_config}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1060,
        "wires": [
            [
                "a04b59e608979f6a"
            ]
        ]
    },
    {
        "id": "4a4d95ebe5f4a0a2",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "0.2",
        "props": [],
        "repeat": "0.2",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 520,
        "wires": [
            [
                "573d0d0f99f72b4b"
            ]
        ]
    },
    {
        "id": "8d60954c80270a11",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "on_click",
        "func": "robot_states = global.get(\"robot_states\")\n\n// set all to false\nfor(const robot_name in robot_states){\n    robot_state = robot_states[robot_name]\n    robot_state.gui.selected = false\n}\n\n// set clicked to true\nclicked_robot_name = msg.payload.title\nrobot_state = robot_states[clicked_robot_name]\nrobot_state.gui.selected = true\n\ngui_state = global.get(\"gui_state\")\ngui_state.selected_robot_name = clicked_robot_name",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1060,
        "wires": []
    },
    {
        "id": "0a4f4cb54557ce2f",
        "type": "ui_template",
        "z": "072468ee5a218dc0",
        "group": "9f2da61.3353758",
        "name": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "format": "<link rel=\"stylesheet\" href=\"/flight/css/flightindicators.css\"/>\n<script src=\"/flight/js/jquery.flightindicators.js\"></script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "global",
        "className": "",
        "x": 1060,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "2e8781f4b35114a4",
        "type": "ui_template",
        "z": "072468ee5a218dc0",
        "group": "a48b13904097fb6a",
        "name": "Roll, Pitch, Heading",
        "order": 2,
        "width": 6,
        "height": 9,
        "format": "<div><span id=\"attitude\"></span><span id=\"heading\"></span></div> <!--<span id=\"airspeed\"></span></div>-->\n\n<script>\n(function(scope) {\n    var options = {\n    \tsize : 180,\t\t\t\t// Sets the size in pixels of the indicator (square)\n    \troll : 0,\t\t\t\t// Roll angle in degrees for an attitude indicator\n    \tpitch : 0,\t\t\t\t// Pitch angle in degrees for an attitude indicator\n    \theading: 0,\t\t\t\t// Heading angle in degrees for an heading indicator\n    \tvario: 0,\t\t\t\t// Variometer in 1000 feets/min for the variometer indicator\n    \tairspeed: 0,\t\t\t// Air speed in knots for an air speed indicator\n    \taltitude: 0,\t\t\t// Altitude in feets for an altimeter indicator\n    \tpressure: 1000,\t\t\t// Pressure in hPa for an altimeter indicator\n    \tshowBox : false,\t\t\t// Sets if the outer squared box is visible or not (true or false)\n    \timg_directory : '/flight/img/'\t// The directory where the images are saved to\n    }\n    var atti = $.flightIndicator('#attitude', 'attitude',options);\n    var heading = $.flightIndicator('#heading', 'heading',options);\n    var speed = $.flightIndicator('#airspeed', 'airspeed',options);\n    scope.$watch('msg', function(msg) {\n        if (msg) {\n          if(msg.topic == \"roll\"){\n              atti.setRoll(msg.payload)\n          }\n          if(msg.topic == \"pitch\"){\n              atti.setPitch(-msg.payload)\n          }\n          if(msg.topic == \"heading\"){\n              heading.setHeading(msg.payload)\n          }\n          if(msg.topic == \"speed\"){\n              speed.setAirSpeed(msg.payload)\n          }\n          \n        }\n  });\n})(scope);\n\n</script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 890,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "c375e4a5e57177ab",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[roll, pitch, heading]",
        "func": "if(msg){\n    return [\n        {topic:\"roll\", payload:msg.base.roll},\n        {topic:\"pitch\", payload:msg.base.pitch},\n        {topic:\"heading\", payload:msg.base.heading}\n        ]\n}\n",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 520,
        "wires": [
            [
                "2e8781f4b35114a4"
            ],
            [
                "2e8781f4b35114a4"
            ],
            [
                "2e8781f4b35114a4"
            ]
        ]
    },
    {
        "id": "971e5bcf85bd8530",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "1",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 1060,
        "wires": [
            [
                "b17ab9737c48ebe8"
            ]
        ]
    },
    {
        "id": "573d0d0f99f72b4b",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "Selected Robot State",
        "func": "gui_state = global.get(\"gui_state\")\nselected_robot_name = gui_state.selected_robot_name\nrobot_states = global.get(\"robot_states\")\n\nif(!(selected_robot_name in robot_states)){\n    return\n}\n\nrobot_state = robot_states[selected_robot_name]\nsince_last_update = (Date.now() - robot_state.last_update)/1000\n\nif(since_last_update > 60){\n    return\n}\n\nrobot_state = robot_states[selected_robot_name]\n\nreturn robot_state",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 520,
        "wires": [
            [
                "c375e4a5e57177ab",
                "216163265f4ce78b",
                "7d7f737ccec8bdd1",
                "8346958d8c2ff728",
                "5ccaf5f3bf5ae5cf"
            ]
        ]
    },
    {
        "id": "216163265f4ce78b",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[vbs, lcg, tcg]",
        "func": "if(msg){\n    return [\n        {topic:\"vbs\", payload:msg.base.vbs},\n        {topic:\"lcg\", payload:msg.base.lcg},\n        {topic:\"tcg\", payload:msg.base.tcg},\n        ]\n}\n",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 600,
        "wires": [
            [
                "4e4363d933c20d6c"
            ],
            [
                "656a52f66d5d0bda"
            ],
            [
                "d0bc35b89669966d"
            ]
        ]
    },
    {
        "id": "7d7f737ccec8bdd1",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[T1, T2]",
        "func": "if(msg){\n    return [\n        {topic:\"t1\", payload:msg.base.t1},\n        {topic:\"t2\", payload:msg.base.t2}\n        ]\n}\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 700,
        "wires": [
            [
                "edb7322d84e1824d"
            ],
            [
                "5c9b93966cd3ce1c"
            ]
        ]
    },
    {
        "id": "4e4363d933c20d6c",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "VBS",
        "group": "a48b13904097fb6a",
        "order": 5,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "VBS",
        "label": "%",
        "format": "{{value | number:2}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 850,
        "y": 560,
        "wires": []
    },
    {
        "id": "656a52f66d5d0bda",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "LCG",
        "group": "a48b13904097fb6a",
        "order": 6,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "LCG",
        "label": "%",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 850,
        "y": 600,
        "wires": []
    },
    {
        "id": "edb7322d84e1824d",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "T1",
        "group": "a48b13904097fb6a",
        "order": 3,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "T1",
        "label": "rpm",
        "format": "{{value | number:1}}",
        "min": "-2000",
        "max": "2000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "-800",
        "seg2": "800",
        "className": "",
        "x": 850,
        "y": 680,
        "wires": []
    },
    {
        "id": "5c9b93966cd3ce1c",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "T2",
        "group": "a48b13904097fb6a",
        "order": 4,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "T2",
        "label": "rpm",
        "format": "{{value | number:1}}",
        "min": "-2000",
        "max": "2000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "-800",
        "seg2": "800",
        "className": "",
        "x": 850,
        "y": 720,
        "wires": []
    },
    {
        "id": "d0bc35b89669966d",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "TCG",
        "group": "a48b13904097fb6a",
        "order": 8,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "TCG",
        "label": "%",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 850,
        "y": 640,
        "wires": []
    },
    {
        "id": "8346958d8c2ff728",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "BT Tip Log",
        "func": "// \"bt\": {\n//             \"tip\": {\n//                 \"name\": \"???\",\n//                 \"message\": \"\",\n//                 \"status\": \"???\"\n//             },\n//             \"algae_farm_enable\": false,\n//             \"live_wp_enable\": false,\n//             \"gui_wp_enable\": false,\n//             \"current_wp\": {},\n//             \"current_plan\": {},\n//             \"last_heartbeat\": null\n//         },\n\nfunction make_tip_str(tip){\n    c = \"black\"\n    icon = \"\"\n    switch(tip.status){\n        case \"failure\":\n            c = \"red\"\n            icon = \"\"\n            break\n        case \"success\":\n            c = \"green\"\n            icon = \"\"\n            break\n        case \"running\":\n            c = \"blue\"\n            icon = \"\"\n            break\n    }\n    \n    tip_type = tip.name.slice(0,1)\n    tip_name = tip.name.slice(2)\n    \n    t = \"\"\n    if(tip.time > 10){\n        t = new Date(tip.time).toTimeString().slice(0,8)\n    }\n    \n    title = t + \" \" + icon + \" <font color=\" + c + \">\" + tip_name\n    msg = \"<font color=\" + c +\">\" + tip.message\n    \n    return [title, msg];\n}\n\ncurrent_tip = msg.bt.tip;\n\n// get the current log, make sure its length matches the value \n// set in the gui and then put it back into global context\ngui_state = global.get(\"gui_state\")\ntips = gui_state.bt_tip_log\ntip_log_len = gui_state.bt_tip_log_len\n// too short\nwhile(tips.length < tip_log_len){\n    tips.push({\n        name:\"\",\n        message:\"\",\n        status:\"\",\n        time:\"\"\n    })\n}\n// too long\nif(tips.length > tip_log_len){\n    tips = tips.slice(0,tip_log_len)\n}\nglobal.set(\"gui_state.bt_tip_log\", tips)\n\nlast_tip = tips[0]\nif(last_tip){\n    if (!(last_tip.name == current_tip.name && last_tip.status == current_tip.status)){\n        // something meaningful have changed, shift things around\n        for(let i=tips.length-1; i>0; i--){\n            tips[i] = tips[i-1]\n        }\n    }\n}\n// otherwise just update the top\ntips[0] = current_tip\ntips[0].time = Date.now()\n\nouts = []\nfor(let i=0; i<tips.length; i++){\n    r = make_tip_str(tips[i])\n    list_item = {\n        title: r[0],\n        description: r[1]\n    }\n    outs.push(list_item)\n}\n\nreturn {payload:outs};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 900,
        "wires": [
            [
                "93832a52fddd1fe6"
            ]
        ]
    },
    {
        "id": "f5fa53da63658314",
        "type": "config",
        "z": "072468ee5a218dc0",
        "name": "gui_state",
        "properties": [
            {
                "p": "gui_state",
                "pt": "global",
                "to": "{\"selected_robot_name\":null,\"selected_wp\":{},\"selected_plan\":{},\"planning_mode\":false,\"batt_v_minmax\":[99999,-1],\"draw_tracks\":false,\"bt_tip_log\":[],\"bt_tip_log_len\":5}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 460,
        "y": 420,
        "wires": []
    },
    {
        "id": "c50d772c522ec5c1",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "lat_lon",
        "topic": "smarc/+/dr/lat_lon",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 60,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "d8a229ed73bf1a50",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Yaw",
        "topic": "smarc/+/dr/yaw",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 60,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "d933ebc2598c89a7",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Depth",
        "topic": "smarc/+/dr/depth",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 100,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "ce5f3fc1415b3d44",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Roll",
        "topic": "smarc/+/dr/roll",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 100,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "f1f6aa8630b2459f",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Pitch",
        "topic": "smarc/+/dr/pitch",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 60,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "6bc6d108042d5433",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "VBS_fb",
        "topic": "smarc/+/core/vbs_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 140,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "1e257bc81da80283",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "LCG_fb",
        "topic": "smarc/+/core/lcg_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 180,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "cb767c1ced5d8bfa",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "T1_fb",
        "topic": "smarc/+/core/thruster1_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 140,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "b7d61f1afee897a8",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "T2_fb",
        "topic": "smarc/+/core/thruster2_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 180,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "5ab4d2fba4e40e73",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "batt",
        "topic": "smarc/+/core/battery",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 180,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "3ef59b0e6f35a957",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "gps",
        "topic": "smarc/+/core/gps",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 100,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "88437af12ac3ebb4",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Altitude",
        "topic": "smarc/+/dr/altitude",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 140,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "5c17640c744c8c15",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "goto_wp_goal",
        "topic": "smarc/+/bt/last_wp",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 210,
        "y": 260,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "73e7fa1d9b7b8bc2",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "bt tip",
        "topic": "smarc/+/bt/tip",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 350,
        "y": 260,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "1447262162547810",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "livewp enable",
        "topic": "smarc/+/bt/live_wp/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 210,
        "y": 300,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "9fdc56fc7a754fcd",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "algae enable",
        "topic": "smarc/+/bt/algae_farm/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 370,
        "y": 300,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "a0a635a67725ceec",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "bt heartbeat",
        "topic": "smarc/+/bt/heartbeat",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 490,
        "y": 260,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "16ac9c75fa3b93ca",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "bt missioncontrol",
        "topic": "smarc/+/bt/mission_control",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 540,
        "y": 300,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "2a5530edfa53f040",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "guiwp enable",
        "topic": "smarc/+/bt/gui_wp/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 650,
        "y": 260,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "e58d020e0faf117d",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "update robot state",
        "func": "function to_deg(d){\n    deg = d * (180/Math.PI);\n    deg = deg%360;\n    return deg;\n}\n\nfunction to_northing(d){\n    h = Math.PI/2 - d;\n    return to_deg(h);\n}\n\nfunction new_robot_state(robot_name){\n    return {\n        \"last_update\":0,\n        \"base\": {\n            \"name\": robot_name,\n            \"lat\": null,\n            \"lon\": null,\n            \"heading\": 0,\n            \"roll\": 0,\n            \"pitch\": 0,\n            \"depth\": 0,\n            \"altitude\": 0,\n            \"vbs\": 0,\n            \"lcg\": 0,\n            \"tcg\": 0,\n            \"t1\": 0,\n            \"t2\": 0,\n            \"batt_v\": 0,\n            \"gps_lat\": null,\n            \"gps_lon\": null\n        },\n        \"bt\": {\n            \"tip\": {\n                \"name\": \"???\",\n                \"message\": \"\",\n                \"status\": \"???\"\n            },\n            \"algae_farm_enable\": false,\n            \"live_wp_enable\": false,\n            \"gui_wp_enable\": false,\n            \"current_wp\": {},\n            \"current_plan\": {},\n            \"last_heartbeat\": null\n        },\n        \"gui\": {\n            \"selected\": false,\n            \"dr\":{\n                \"name\": robot_name,\n                \"label\": robot_name,\n                \"lat\": null,\n                \"lon\": null,\n                \"heading\": 0,\n                \"layer\": robot_name,\n                \"icon\": \"ship\",\n                \"color\": \"yellow\",\n                \"iconColor\": \"yellow\"\n            },\n            \"gps\":{\n                \"name\": \"robot_name\"+\"_gps\",\n                \"lat\": null,\n                \"lon\": null,\n                \"layer\": robot_name,\n                \"icon\": \"satellite\",\n                \"color\": \"green\",\n                \"iconColor\": \"green\",\n            }\n        }\n    }\n}\n\n// each mqtt_in node also emits the entire topic\n// so we can switch robot name and which topic it is coming from\nconst [smarc, robot_name, ...topic_parts] = msg.topic.split('/');\nmqtt_topic = topic_parts.join(\"/\")\n\n// then try to get this robot from the list of vehicles\n// if its not there, construct an empty state object\nrobot_states = global.get(\"robot_states\")\n\nif(!(robot_states)){\n    global.set(\"robot_states\", {})\n}\n\nif(!(robot_name in robot_states)){\n    robot_states[robot_name] = new_robot_state(robot_name)\n}\n\nrobot_state = robot_states[robot_name]\n\n\nrobot_state.last_update = Date.now()\n\npayload = msg.payload\nswitch(mqtt_topic){\n    case \"dr/lat_lon\":\n        robot_state.base.lat = payload.latitude;\n        robot_state.base.lon = payload.longitude;\n        robot_state.gui.dr.lat = payload.latitude;\n        robot_state.gui.dr.lon = payload.longitude;\n        break;\n        \n    case \"dr/yaw\":\n        hdg = to_northing(payload.data)\n        robot_state.base.heading = hdg;\n        robot_state.gui.dr.heading = hdg;\n        break;\n        \n    case \"dr/roll\":\n        robot_state.base.roll = to_deg(payload.data);\n        break;\n        \n    case \"dr/pitch\":\n        robot_state.base.pitch = to_deg(payload.data);\n        break;\n        \n    case \"dr/depth\":\n        robot_state.base.depth = payload.data;\n        break;\n\n    case \"dr/altitude\":\n        robot_state.base.altitude = payload.data;\n        break;        \n        \n    case \"core/vbs_fb\":\n        robot_state.base.vbs = payload.value;\n        break;\n        \n    case \"core/lcg_fb\":\n        robot_state.base.lcg = payload.value;\n        break;\n        \n    case \"core/thruster1_fb\":\n        robot_state.base.t1 = payload.rpm.rpm;\n        break;\n        \n    case \"core/thruster2_fb\":\n        robot_state.base.t2 = payload.rpm.rpm;\n        break;\n        \n    case \"core/battery\":\n        robot_state.base.batt_v = payload.voltage;\n        break;\n        \n    case \"core/gps\":\n        robot_state.base.gps_lat = payload.latitude;\n        robot_state.base.gps_lon = payload.longitude;\n        robot_state.gui.gps.lat = payload.latitude;\n        robot_state.gui.gps.lon = payload.longitude;\n        break;\n        \n    case \"bt/last_wp\":\n        robot_state.bt.current_wp = payload;\n        break;\n        \n    case \"bt/tip\":\n        robot_state.bt.tip.name = payload.name;\n        robot_state.bt.tip.message = payload.message;\n        status_str = {\n            0:\"unknown\",\n            1:\"invalid\",\n            2:\"running\",\n            3:\"success\",\n            4:\"failure\"\n        }\n        robot_state.bt.tip.status = status_str[payload.status]\n        break;\n        \n    case \"bt/live_wp/enable\":\n        robot_state.bt.live_wp_enable = payload.data;\n        break;\n        \n    case \"bt/algae_farm/enable\":\n        robot_state.bt.algae_farm_enable = payload.data;\n        break;\n        \n    case \"bt/gui_wp/enable\":\n        robot_state.bt.gui_wp_enable = payload.data;\n        break;\n        \n    case \"bt/heartbeat\":\n        robot_state.bt.last_heartbeat = Date.now()\n        break;\n        \n    case \"bt/mission_control\":\n        if(payload.command == 5){ // is_feedback\n            robot_state.bt.current_plan = payload\n        }\n}",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 160,
        "wires": []
    },
    {
        "id": "93832a52fddd1fe6",
        "type": "ui_list",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "name": "BT Log",
        "order": 2,
        "width": 0,
        "height": 0,
        "lineType": "three",
        "actionType": "none",
        "allowHTML": true,
        "outputs": 0,
        "topic": "",
        "x": 860,
        "y": 900,
        "wires": []
    },
    {
        "id": "268c9d6ea03e8ef2",
        "type": "ui_numeric",
        "z": "072468ee5a218dc0",
        "name": "",
        "label": "BT Log Len",
        "tooltip": "",
        "group": "81d4dedb195938c4",
        "order": 1,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": "1",
        "max": "20",
        "step": 1,
        "className": "",
        "x": 470,
        "y": 1100,
        "wires": [
            [
                "850a3a74ca62d541"
            ]
        ]
    },
    {
        "id": "850a3a74ca62d541",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gui_state.bt_tip_log_len",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "2ad1bf5fcff4a626",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "gui_state.bt_tip_log_len",
        "payloadType": "global",
        "x": 250,
        "y": 1100,
        "wires": [
            [
                "268c9d6ea03e8ef2"
            ]
        ]
    },
    {
        "id": "9a4668d9403279bb",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "",
        "group": "a48b13904097fb6a",
        "order": 7,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "Battery V",
        "label": "V",
        "format": "{{value | number:2}}",
        "min": "10",
        "max": "14",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "12",
        "seg2": "13",
        "className": "",
        "x": 860,
        "y": 760,
        "wires": []
    },
    {
        "id": "5ccaf5f3bf5ae5cf",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[current V, minmax]",
        "func": "// gui_st = global.get(\"gui_state\")\n// g_minmax = gui_st.batt_v_minmax\n// g_min = g_minmax[0]\n// g_max = g_minmax[1]\n\n// //node.warn(g_min+','+g_max+','+msg.payload)\n// // 0, 14.5, 12.5\n// if(g_min <= 0 || g_min > msg.payload){\n//     g_min = msg.payload-2\n//     if(g_min < 0){\n//         g_min = 0\n//     }\n// }\n// if(g_max == -1 || g_max < msg.payload){\n//     g_max = msg.payload+2\n// }\n\n// gui_st.batt_v_minmax = [g_min, g_max]\n\n// msg.ui_control = {min:g_min ,max:g_max}\n// return msg\n\nbatt_minmax = global.get(\"gui_state.batt_v_minmax\")\nmin = batt_minmax[0]\nmax = batt_minmax[1]\ncurrent = msg.base.batt_v\n\nif(current >= max){\n    max = current+2\n}\nif(current <= min){\n    min = current-2\n}\nglobal.set(\"gui_state.batt_v_minmax\", [min,max])\n\nreturn [\n    {topic:\"batt\", payload:current},\n    {ui_control: {min:min, max:max}}\n    ]\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 760,
        "wires": [
            [
                "9a4668d9403279bb"
            ],
            [
                "9a4668d9403279bb"
            ]
        ]
    }
]